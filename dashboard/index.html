<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XIVIX Tower Control</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg-primary:#0a0e17;--bg-secondary:#111827;--bg-card:#1a2235;--bg-input:#0f1729;--border:#2a3548;--text-primary:#e8ecf4;--text-secondary:#8896ab;--text-muted:#556479;--accent-blue:#3b82f6;--accent-green:#22c55e;--accent-amber:#f59e0b;--accent-red:#ef4444;--accent-purple:#a855f7;--accent-cyan:#06b6d4}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'IBM Plex Sans KR',-apple-system,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}
.app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
.sidebar{background:var(--bg-secondary);border-right:1px solid var(--border);position:sticky;top:0;height:100vh;overflow-y:auto;display:flex;flex-direction:column;z-index:50}
.sidebar-brand{padding:1.5rem 1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.sidebar-brand h1{font-size:1.1rem;font-weight:700;letter-spacing:.05em;color:var(--accent-blue)}.sidebar-brand span{font-size:.65rem;color:var(--text-muted);display:block;margin-top:2px;letter-spacing:.1em}
.sidebar-close{display:none;background:none;border:none;color:var(--text-muted);font-size:1.3rem;cursor:pointer;padding:.3rem}
.nav-section{padding:.8rem 0}.nav-label{padding:.3rem 1.2rem;font-size:.6rem;text-transform:uppercase;letter-spacing:.12em;color:var(--text-muted);font-weight:600}
.nav-item{display:flex;align-items:center;gap:.6rem;padding:.55rem 1.2rem;cursor:pointer;font-size:.82rem;color:var(--text-secondary);transition:all .15s;border-left:3px solid transparent}
.nav-item:hover{background:rgba(59,130,246,.06);color:var(--text-primary)}.nav-item.active{background:rgba(59,130,246,.1);color:var(--accent-blue);border-left-color:var(--accent-blue);font-weight:500}
.nav-icon{width:16px;height:16px;opacity:.7;flex-shrink:0}
.opt-tags{display:flex;gap:.25rem;flex-wrap:wrap;padding:1rem 1.2rem;border-top:1px solid var(--border);margin-top:auto}
.opt-tag{font-size:.58rem;padding:.12rem .4rem;border-radius:3px;font-weight:600;letter-spacing:.05em}
.opt-tag.seo{background:rgba(59,130,246,.15);color:var(--accent-blue)}.opt-tag.aeo{background:rgba(168,85,247,.15);color:var(--accent-purple)}.opt-tag.geo{background:rgba(34,197,94,.15);color:var(--accent-green)}.opt-tag.crank{background:rgba(245,158,11,.15);color:var(--accent-amber)}.opt-tag.nlogic{background:rgba(6,182,212,.15);color:var(--accent-cyan)}
.main{overflow-y:auto}.main-header{padding:1rem 1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--bg-secondary);position:sticky;top:0;z-index:10}
.main-header h2{font-size:.95rem;font-weight:600}.header-actions{display:flex;gap:.4rem;align-items:center}
.hamburger{display:none;background:none;border:none;color:var(--text-primary);font-size:1.3rem;cursor:pointer;padding:.3rem;margin-right:.5rem}
.main-content{padding:1.2rem}
.btn{padding:.45rem .9rem;border-radius:6px;font-size:.78rem;font-weight:500;border:none;cursor:pointer;font-family:inherit;transition:all .15s;display:inline-flex;align-items:center;gap:.35rem;white-space:nowrap}
.btn-primary{background:var(--accent-blue);color:#fff}.btn-primary:hover{background:#2563eb}.btn-success{background:var(--accent-green);color:#fff}.btn-outline{background:transparent;color:var(--text-secondary);border:1px solid var(--border)}.btn-outline:hover{border-color:var(--accent-blue);color:var(--accent-blue)}.btn-danger{background:rgba(239,68,68,.15);color:var(--accent-red);border:none}.btn-sm{padding:.3rem .6rem;font-size:.72rem}.btn-lg{padding:.6rem 1.3rem;font-size:.85rem}
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1.2rem;margin-bottom:1rem}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:.4rem}.card-title{font-size:.88rem;font-weight:600}
.stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:.7rem;margin-bottom:1.2rem}.stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:.9rem}.stat-value{font-size:1.5rem;font-weight:700;font-family:'JetBrains Mono',monospace}.stat-label{font-size:.65rem;color:var(--text-muted);margin-top:.15rem;letter-spacing:.05em}
.stat-card.blue .stat-value{color:var(--accent-blue)}.stat-card.green .stat-value{color:var(--accent-green)}.stat-card.amber .stat-value{color:var(--accent-amber)}.stat-card.purple .stat-value{color:var(--accent-purple)}.stat-card.cyan .stat-value{color:var(--accent-cyan)}
table{width:100%;border-collapse:collapse;font-size:.8rem}th{text-align:left;padding:.55rem .5rem;color:var(--text-muted);font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;font-weight:600;border-bottom:1px solid var(--border)}td{padding:.6rem .5rem;border-bottom:1px solid rgba(42,53,72,.5)}tr:hover td{background:rgba(59,130,246,.03)}
.status{display:inline-block;padding:.12rem .45rem;border-radius:4px;font-size:.68rem;font-weight:600}.status-active{background:rgba(34,197,94,.15);color:var(--accent-green)}.status-pending{background:rgba(245,158,11,.15);color:var(--accent-amber)}
.opt-indicators{display:flex;gap:.25rem}.opt-dot{width:8px;height:8px;border-radius:50%}.opt-dot.on{opacity:1}.opt-dot.off{opacity:.2}.opt-dot.seo{background:var(--accent-blue)}.opt-dot.aeo{background:var(--accent-purple)}.opt-dot.geo{background:var(--accent-green)}.opt-dot.crank{background:var(--accent-amber)}.opt-dot.nlogic{background:var(--accent-cyan)}
.form-group{margin-bottom:.9rem}.form-label{display:block;font-size:.72rem;color:var(--text-muted);margin-bottom:.25rem;font-weight:500}
.form-input,.form-textarea,.form-select{width:100%;padding:.55rem .75rem;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:.82rem;font-family:inherit;transition:border-color .15s}
.form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--accent-blue)}.form-textarea{resize:vertical;min-height:100px}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}.form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.7rem}
.map-options{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}.map-option{display:flex;align-items:center;gap:.5rem;padding:.6rem .8rem;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s}
.map-option:hover{border-color:var(--accent-blue)}.map-option.selected{border-color:var(--accent-blue);background:rgba(59,130,246,.05)}.map-option input{display:none}
.map-check{width:16px;height:16px;border:2px solid var(--border);border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.map-option.selected .map-check{background:var(--accent-blue);border-color:var(--accent-blue)}.map-option.selected .map-check::after{content:'';width:4px;height:8px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg);margin-top:-2px}
.map-name{font-size:.8rem;font-weight:500}.map-desc{font-size:.65rem;color:var(--text-muted)}
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:1rem;overflow-x:auto}.tab{padding:.55rem 1rem;font-size:.78rem;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;font-weight:500;white-space:nowrap}.tab:hover{color:var(--text-primary)}.tab.active{color:var(--accent-blue);border-bottom-color:var(--accent-blue)}
.console{background:#0c0c0c;border-radius:8px;padding:1rem;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#4ade80;max-height:350px;overflow-y:auto;line-height:1.8;word-break:break-all}.console .c-info{color:#3b82f6}.console .c-warn{color:#f59e0b}.console .c-ok{color:#22c55e}.console .c-dim{color:#556479}
.toast{position:fixed;bottom:2rem;right:1rem;left:1rem;background:var(--bg-card);border:1px solid var(--accent-green);border-radius:8px;padding:.7rem 1.1rem;font-size:.82rem;z-index:1000;transform:translateY(100px);opacity:0;transition:all .3s;text-align:center}.toast.show{transform:translateY(0);opacity:1}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;display:none;align-items:center;justify-content:center;padding:1rem}.modal-overlay.show{display:flex}.modal{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;max-width:640px;width:100%;max-height:85vh;overflow-y:auto}.modal h3{font-size:1rem;margin-bottom:1rem}
.guide-step{display:flex;gap:1rem;padding:.8rem 0;border-bottom:1px solid rgba(42,53,72,.4)}.guide-step:last-child{border-bottom:none}.guide-num{width:28px;height:28px;border-radius:50%;background:rgba(59,130,246,.15);color:var(--accent-blue);display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:700;flex-shrink:0;font-family:'JetBrains Mono'}
.guide-text h4{font-size:.85rem;font-weight:600;margin-bottom:.2rem}.guide-text p{font-size:.78rem;color:var(--text-secondary);line-height:1.5}.guide-text code{background:rgba(59,130,246,.1);color:var(--accent-blue);padding:.1rem .3rem;border-radius:3px;font-size:.72rem;font-family:'JetBrains Mono'}
.flow-branch{display:grid;grid-template-columns:repeat(5,1fr);gap:.5rem;margin-top:.3rem}.flow-box{padding:.5rem .6rem;border-radius:6px;font-size:.7rem;font-weight:500;text-align:center}
.google-auth-card{background:linear-gradient(135deg,rgba(66,133,244,.06),rgba(52,168,83,.04));border:1px solid rgba(66,133,244,.15)}
.lang-toggle{display:flex;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;overflow:hidden}.lang-btn{padding:.25rem .5rem;font-size:.68rem;cursor:pointer;border:none;background:transparent;color:var(--text-muted);font-family:inherit;font-weight:500}.lang-btn.active{background:var(--accent-blue);color:#fff}
/* Settings */
.setting-section{margin-bottom:1.2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}.setting-section:last-child{border-bottom:none}
.setting-title{font-size:.82rem;font-weight:600;margin-bottom:.6rem;display:flex;align-items:center;gap:.4rem}
.api-key-input{font-family:'JetBrains Mono',monospace;font-size:.75rem;letter-spacing:-.02em}
.key-status{display:inline-flex;align-items:center;gap:.3rem;font-size:.68rem;padding:.2rem .5rem;border-radius:4px;margin-left:.5rem}
.key-ok{background:rgba(34,197,94,.12);color:var(--accent-green)}.key-none{background:rgba(239,68,68,.12);color:var(--accent-red)}
.mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:40}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
/* Mobile */
@media(max-width:768px){
.app{grid-template-columns:1fr}
.sidebar{position:fixed;left:-260px;width:260px;height:100vh;transition:left .3s;z-index:50}
.sidebar.open{left:0}
.sidebar-close{display:block}
.mobile-overlay.show{display:block}
.hamburger{display:block}
.stats-grid{grid-template-columns:repeat(2,1fr)}
.form-row,.form-row-3,.map-options{grid-template-columns:1fr}
.flow-branch{grid-template-columns:repeat(3,1fr)}
.stat-value{font-size:1.2rem}
table{font-size:.72rem;display:block;overflow-x:auto}
.main-content{padding:.8rem}
.card{padding:.9rem}
.toast{left:.5rem;right:.5rem}
}
@media(max-width:400px){
.stats-grid{grid-template-columns:1fr 1fr}
.flow-branch{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="app">
<div class="mobile-overlay" id="mobileOverlay" onclick="closeSidebar()"></div>
<aside class="sidebar" id="sidebar">
<div class="sidebar-brand"><div><h1>XIVIX</h1><span>Tower Control v1.1</span></div><button class="sidebar-close" onclick="closeSidebar()">X</button></div>
<div class="nav-section">
<div class="nav-label">관리</div>
<div class="nav-item active" data-page="guide" onclick="go('guide')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>사용 가이드</div>
<div class="nav-item" data-page="dashboard" onclick="go('dashboard')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>대시보드</div>
<div class="nav-item" data-page="add" onclick="go('add')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>매장 등록</div>
<div class="nav-item" data-page="businesses" onclick="go('businesses')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/></svg>매장 목록</div>
</div>
<div class="nav-section">
<div class="nav-label">최적화</div>
<div class="nav-item" data-page="maps" onclick="go('maps')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/></svg>지도 플랫폼</div>
<div class="nav-item" data-page="google-auth" onclick="go('google-auth')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>구글 인증</div>
</div>
<div class="nav-section">
<div class="nav-label">시스템</div>
<div class="nav-item" data-page="settings" onclick="go('settings')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>설정</div>
<div class="nav-item" data-page="build" onclick="go('build')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>빌드 & 배포</div>
<div class="nav-item" data-page="preview" onclick="go('preview')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>미리보기</div>
</div>
<div class="opt-tags"><span class="opt-tag seo">SEO</span><span class="opt-tag aeo">AEO</span><span class="opt-tag geo">GEO</span><span class="opt-tag crank">C-RANK</span><span class="opt-tag nlogic">N-LOGIC</span></div>
</aside>

<div class="main">
<div class="main-header">
<div style="display:flex;align-items:center">
<button class="hamburger" onclick="openSidebar()">&#9776;</button>
<h2 id="pageTitle">사용 가이드</h2>
</div>
<div class="header-actions">
<button class="btn btn-outline btn-sm" onclick="go('settings')">설정</button>
<button class="btn btn-primary btn-sm" onclick="go('build')">빌드</button>
</div>
</div>
<div class="main-content">

<!-- 사용 가이드 -->
<div id="page-guide" class="page">
<div class="card"><div class="card-title" style="margin-bottom:.3rem">XIVIX Tower Control 이란?</div><p style="font-size:.82rem;color:var(--text-secondary);line-height:1.6">매장 정보를 한 곳에 입력하면, 구글/네이버/카카오/T-MAP 등 모든 검색 엔진과 AI에 최적화된 페이지가 자동 생성됩니다.</p></div>
<div class="card"><div class="card-title" style="margin-bottom:.8rem">시작하기 (4단계)</div>
<div class="guide-step"><div class="guide-num">1</div><div class="guide-text"><h4>설정</h4><p><code>설정</code> 메뉴에서 GitHub 토큰, Cloudflare 키, 도메인, 기본 지도 등을 먼저 입력하세요. 한 번만 하면 됩니다.</p></div></div>
<div class="guide-step"><div class="guide-num">2</div><div class="guide-text"><h4>매장 등록</h4><p><code>매장 등록</code>에서 Smart Paste(복사 붙여넣기 자동 분류) 또는 직접 입력으로 등록.</p></div></div>
<div class="guide-step"><div class="guide-num">3</div><div class="guide-text"><h4>구글 인증 (1회)</h4><p><code>구글 인증</code>에서 "구글 인증 시작" -> 점주 전화/우편 인증 -> "인증 완료" 클릭.</p></div></div>
<div class="guide-step"><div class="guide-num">4</div><div class="guide-text"><h4>빌드 & 배포</h4><p><code>빌드 & 배포</code>에서 실행하면 모든 최적화 파일이 자동 생성되고 배포됩니다.</p></div></div>
</div>
<div class="card"><div class="card-title" style="margin-bottom:.8rem">등록 후 동작 흐름</div>
<div style="background:var(--bg-input);border-radius:8px;padding:1rem">
<div style="text-align:center;margin-bottom:.6rem"><span class="flow-box" style="background:rgba(59,130,246,.15);color:var(--accent-blue);display:inline-block">매장 정보 입력</span></div>
<div style="text-align:center;color:var(--text-muted)">|</div>
<div style="text-align:center;margin:.2rem 0"><span class="flow-box" style="background:rgba(168,85,247,.15);color:var(--accent-purple);display:inline-block">빌드 (자동 생성)</span></div>
<div style="text-align:center;color:var(--text-muted)">|</div>
<div class="flow-branch">
<div class="flow-box" style="background:rgba(59,130,246,.12);color:var(--accent-blue);font-size:.65rem"><strong>SEO</strong><br>Schema.org<br>sitemap.xml</div>
<div class="flow-box" style="background:rgba(168,85,247,.12);color:var(--accent-purple);font-size:.65rem"><strong>AEO</strong><br>llms.txt<br>AI 크롤러용</div>
<div class="flow-box" style="background:rgba(34,197,94,.12);color:var(--accent-green);font-size:.65rem"><strong>GEO</strong><br>FAQ 리치<br>AI Overview</div>
<div class="flow-box" style="background:rgba(245,158,11,.12);color:var(--accent-amber);font-size:.65rem"><strong>C-RANK</strong><br>네이버 카페<br>블로그 연동</div>
<div class="flow-box" style="background:rgba(6,182,212,.12);color:var(--accent-cyan);font-size:.65rem"><strong>N-LOGIC</strong><br>네이버 검색<br>메타태그</div>
</div>
<div style="text-align:center;color:var(--text-muted);margin-top:.5rem">|</div>
<div style="text-align:center;margin-top:.3rem"><span class="flow-box" style="background:rgba(34,197,94,.15);color:var(--accent-green);display:inline-block">배포 -> 검색 + AI 자동 수집</span></div>
</div></div>
<div class="card"><div class="card-title" style="margin-bottom:.5rem">데모 실행</div><p style="font-size:.78rem;color:var(--text-muted);margin-bottom:.8rem">전체 과정 시뮬레이션을 보여줍니다.</p>
<button class="btn btn-primary btn-lg" onclick="runDemo()">데모 실행</button>
<div id="demoOutput" style="margin-top:1rem;display:none"><div class="console" id="demoConsole"></div></div></div>
</div>

<!-- 설정 -->
<div id="page-settings" class="page" style="display:none">
<div class="card">
<div class="card-title" style="margin-bottom:1rem">시스템 설정</div>
<div class="setting-section">
<div class="setting-title">배포 설정</div>
<div class="form-group"><label class="form-label">배포 대상</label><select class="form-select" id="s_deployTarget" onchange="saveCfg()"><option value="github">GitHub Pages</option><option value="cloudflare">Cloudflare Pages</option></select></div>
<div class="form-group"><label class="form-label">도메인</label><input class="form-input" id="s_domain" placeholder="brands.studioaibotbot.com" onblur="saveCfg()"></div>
<div class="form-group"><label class="form-label">GitHub 저장소</label><input class="form-input" id="s_repo" placeholder="ikjoobang/xivix-tower-control" onblur="saveCfg()"></div>
</div>
<div class="setting-section">
<div class="setting-title">GitHub API 토큰 <span class="key-status" id="ghStatus"></span></div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.4rem">배포 시 GitHub에 자동 Push하는 데 필요합니다. Personal Access Token (classic) 사용.</p>
<div class="form-group"><input class="form-input api-key-input" id="s_ghToken" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" onblur="saveCfg()"></div>
<button class="btn btn-outline btn-sm" onclick="toggleShow('s_ghToken')">토큰 보기/숨기기</button>
<button class="btn btn-primary btn-sm" onclick="testGH()">연결 테스트</button>
</div>
<div class="setting-section">
<div class="setting-title">Cloudflare API 토큰 <span class="key-status" id="cfStatus"></span></div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.4rem">Cloudflare Pages 배포 또는 DNS 설정 시 필요합니다.</p>
<div class="form-group"><input class="form-input api-key-input" id="s_cfToken" type="password" placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" onblur="saveCfg()"></div>
<div class="form-group"><label class="form-label">Account ID</label><input class="form-input api-key-input" id="s_cfAccount" placeholder="764ebfb0ce23114e62876b1873e2154f" onblur="saveCfg()"></div>
<button class="btn btn-outline btn-sm" onclick="toggleShow('s_cfToken')">토큰 보기/숨기기</button>
<button class="btn btn-primary btn-sm" onclick="testCF()">연결 테스트</button>
</div>
<div class="setting-section">
<div class="setting-title">기본 지도 플랫폼</div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.4rem">매장 등록 시 기본으로 선택되는 플랫폼입니다.</p>
<div style="display:flex;flex-wrap:wrap;gap:.4rem">
<label style="display:flex;gap:.3rem;align-items:center;font-size:.78rem;color:var(--text-secondary)"><input type="checkbox" class="s_defMap" value="google" checked onchange="saveCfg()"> Google Maps</label>
<label style="display:flex;gap:.3rem;align-items:center;font-size:.78rem;color:var(--text-secondary)"><input type="checkbox" class="s_defMap" value="naver" checked onchange="saveCfg()"> 네이버</label>
<label style="display:flex;gap:.3rem;align-items:center;font-size:.78rem;color:var(--text-secondary)"><input type="checkbox" class="s_defMap" value="kakao" checked onchange="saveCfg()"> 카카오</label>
<label style="display:flex;gap:.3rem;align-items:center;font-size:.78rem;color:var(--text-secondary)"><input type="checkbox" class="s_defMap" value="tmap" onchange="saveCfg()"> T-MAP</label>
<label style="display:flex;gap:.3rem;align-items:center;font-size:.78rem;color:var(--text-secondary)"><input type="checkbox" class="s_defMap" value="apple" onchange="saveCfg()"> Apple</label>
<label style="display:flex;gap:.3rem;align-items:center;font-size:.78rem;color:var(--text-secondary)"><input type="checkbox" class="s_defMap" value="tesla" onchange="saveCfg()"> Tesla</label>
</div>
</div>
<div class="setting-section">
<div class="setting-title">C-RANK 연동</div>
<div class="form-group"><label class="form-label">cafe-auto-v2 서버 URL (네이버 카페 자동포스팅)</label><input class="form-input" id="s_crankUrl" placeholder="https://cafe-auto.studioaibotbot.com" onblur="saveCfg()"></div>
</div>
<div class="setting-section">
<div class="setting-title">데이터 관리</div>
<div style="display:flex;flex-wrap:wrap;gap:.4rem">
<button class="btn btn-outline" onclick="exportJSON()">JSON 내보내기</button>
<button class="btn btn-outline" onclick="importJSON()">JSON 가져오기</button>
<button class="btn btn-danger" onclick="resetAll()">전체 초기화</button>
</div>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="doImport(this)">
</div>
</div>
</div>

<!-- 대시보드 -->
<div id="page-dashboard" class="page" style="display:none">
<div class="stats-grid">
<div class="stat-card blue"><div class="stat-value" id="statTotal">0</div><div class="stat-label">전체 매장</div></div>
<div class="stat-card green"><div class="stat-value" id="statActive">0</div><div class="stat-label">운영중</div></div>
<div class="stat-card purple"><div class="stat-value" id="statSEO">0</div><div class="stat-label">SEO 적용</div></div>
<div class="stat-card amber"><div class="stat-value" id="statCrank">0</div><div class="stat-label">C-RANK</div></div>
<div class="stat-card cyan"><div class="stat-value" id="statMaps">0</div><div class="stat-label">지도 연동</div></div>
</div>
<div class="card"><div class="card-header"><span class="card-title">관리 매장</span><button class="btn btn-primary btn-sm" onclick="go('add')">+ 등록</button></div>
<table><thead><tr><th>매장</th><th>업종</th><th>최적화</th><th>상태</th><th></th></tr></thead><tbody id="bizTable"></tbody></table></div>
<div class="card"><div class="card-header"><span class="card-title">최적화 현황</span></div><div id="optCoverage" style="display:grid;grid-template-columns:repeat(5,1fr);gap:.5rem"></div></div>
</div>

<!-- 매장 등록 -->
<div id="page-add" class="page" style="display:none">
<div class="tabs"><div class="tab active" onclick="switchTab('paste',this)">Smart Paste</div><div class="tab" onclick="switchTab('manual',this)">직접 입력</div></div>
<div id="addTab-paste"><div class="card"><div class="card-title" style="margin-bottom:.5rem">자동 분류</div><p style="font-size:.78rem;color:var(--text-muted);margin-bottom:.8rem">명함, URL, 텍스트 등 아무거나 붙여넣기.</p>
<textarea id="smartPasteInput" class="form-textarea" style="min-height:150px;font-family:'JetBrains Mono',monospace;font-size:.75rem" placeholder="여기에 매장 정보 붙여넣기..."></textarea>
<div style="margin-top:.7rem;display:flex;gap:.4rem"><button class="btn btn-primary" onclick="smartParse()">자동 분류</button><button class="btn btn-outline" onclick="clearPaste()">초기화</button></div></div>
<div id="parseResult" style="display:none"><div class="card" style="border-color:var(--accent-green)"><div class="card-title" style="color:var(--accent-green);margin-bottom:.8rem">분류 결과</div><div id="parsedFields"></div>
<div style="margin-top:1rem;display:flex;gap:.4rem"><button class="btn btn-success" onclick="confirmAdd()">등록</button><button class="btn btn-outline" onclick="document.getElementById('parseResult').style.display='none'">취소</button></div></div></div>
</div>
<div id="addTab-manual" style="display:none"><div class="card"><div class="card-title" style="margin-bottom:.8rem">매장 정보</div>
<div class="form-row"><div class="form-group"><label class="form-label">매장명</label><input class="form-input" id="f_name" placeholder="강남스마일치과"></div><div class="form-group"><label class="form-label">영문명</label><input class="form-input" id="f_nameEn" placeholder="Gangnam Smile Dental"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">업종</label><select class="form-select" id="f_category"><option value="">선택</option><option value="Dentist">치과</option><option value="Hospital">병원</option><option value="Restaurant">음식점</option><option value="CafeOrCoffeeShop">카페</option><option value="BeautySalon">미용</option><option value="Store">매장</option><option value="EducationalOrganization">학원</option><option value="LocalBusiness">기타</option></select></div><div class="form-group"><label class="form-label">전화</label><input class="form-input" id="f_phone" placeholder="02-555-1234"></div></div>
<div class="form-group"><label class="form-label">주소</label><input class="form-input" id="f_address" placeholder="서울특별시 강남구 강남대로 396"></div>
<div class="form-group"><label class="form-label">웹사이트</label><input class="form-input" id="f_url" placeholder="https://"></div>
<div class="form-row"><div class="form-group"><label class="form-label">위도</label><input class="form-input" id="f_lat" placeholder="37.4979"></div><div class="form-group"><label class="form-label">경도</label><input class="form-input" id="f_lng" placeholder="127.0276"></div></div>
<div class="form-group"><label class="form-label">설명</label><textarea class="form-textarea" id="f_desc" style="min-height:60px" placeholder="매장 설명"></textarea></div>
<div class="form-group"><label class="form-label">영문 설명</label><textarea class="form-textarea" id="f_descEn" style="min-height:60px" placeholder="English description"></textarea></div>
<div class="form-group"><label class="form-label">운영시간</label><input class="form-input" id="f_hours" placeholder="월~금 09:00-21:00"></div>
<div class="form-group"><label class="form-label">전문분야 (쉼표)</label><input class="form-input" id="f_specialties" placeholder="임플란트, 교정"></div>
<div class="form-group"><label class="form-label">키워드 (쉼표)</label><input class="form-input" id="f_keywords" placeholder="강남 치과, 임플란트"></div>
<div class="form-group"><label class="form-label">FAQ (질문|답변)</label><textarea class="form-textarea" id="f_faq" style="min-height:60px" placeholder="비용?|80만~180만원"></textarea></div>
<div class="card-title" style="margin:.8rem 0 .4rem">지도 플랫폼</div>
<div class="map-options" id="mapTargets">
<label class="map-option selected" onclick="toggleMap(this)"><input type="checkbox" value="google" checked><div class="map-check"></div><div><div class="map-name">Google</div></div></label>
<label class="map-option selected" onclick="toggleMap(this)"><input type="checkbox" value="naver" checked><div class="map-check"></div><div><div class="map-name">네이버</div></div></label>
<label class="map-option selected" onclick="toggleMap(this)"><input type="checkbox" value="kakao" checked><div class="map-check"></div><div><div class="map-name">카카오</div></div></label>
<label class="map-option" onclick="toggleMap(this)"><input type="checkbox" value="tmap"><div class="map-check"></div><div><div class="map-name">T-MAP</div></div></label>
<label class="map-option" onclick="toggleMap(this)"><input type="checkbox" value="apple"><div class="map-check"></div><div><div class="map-name">Apple</div></div></label>
<label class="map-option" onclick="toggleMap(this)"><input type="checkbox" value="tesla"><div class="map-check"></div><div><div class="map-name">Tesla</div></div></label>
</div>
<div style="margin-top:1rem;display:flex;gap:.4rem"><button class="btn btn-success btn-lg" onclick="manualAdd()">등록</button><button class="btn btn-outline" onclick="clearManual()">초기화</button></div></div></div>
</div>

<!-- 매장 목록 -->
<div id="page-businesses" class="page" style="display:none"><div class="card"><div class="card-header"><span class="card-title">매장 목록</span><button class="btn btn-outline btn-sm" onclick="exportJSON()">JSON</button></div>
<table><thead><tr><th>매장</th><th>업종</th><th>전화</th><th>최적화</th><th>상태</th><th></th></tr></thead><tbody id="fullBizTable"></tbody></table></div></div>

<!-- 지도 -->
<div id="page-maps" class="page" style="display:none"><div class="card"><div class="card-title" style="margin-bottom:.5rem">지도 플랫폼 최적화</div><p style="font-size:.78rem;color:var(--text-secondary);margin-bottom:1rem">각 플랫폼별 연동 방식입니다.</p>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.8rem">
<div class="card" style="border-color:rgba(66,133,244,.3)"><div style="font-weight:600;margin-bottom:.3rem;color:#4285f4">Google Maps</div><div style="font-size:.72rem;color:var(--text-secondary)">Schema.org + GBP API</div><div class="status status-active" style="margin-top:.3rem">자동</div></div>
<div class="card" style="border-color:rgba(30,200,100,.3)"><div style="font-weight:600;margin-bottom:.3rem;color:#1ec864">네이버 지도</div><div style="font-size:.72rem;color:var(--text-secondary)">스마트 플레이스 등록</div><div class="status status-pending" style="margin-top:.3rem">반자동</div></div>
<div class="card" style="border-color:rgba(254,229,0,.3)"><div style="font-weight:600;margin-bottom:.3rem;color:#fee500">카카오맵</div><div style="font-size:.72rem;color:var(--text-secondary)">Schema.org 크롤링</div><div class="status status-active" style="margin-top:.3rem">자동</div></div>
<div class="card" style="border-color:rgba(231,50,52,.3)"><div style="font-weight:600;margin-bottom:.3rem;color:#e73234">T-MAP</div><div style="font-size:.72rem;color:var(--text-secondary)">GeoCoordinates</div><div class="status status-active" style="margin-top:.3rem">자동</div></div>
<div class="card" style="border-color:rgba(160,160,160,.3)"><div style="font-weight:600;margin-bottom:.3rem;color:#a0a0a0">Apple Maps</div><div style="font-size:.72rem;color:var(--text-secondary)">Business Connect</div><div class="status status-active" style="margin-top:.3rem">자동</div></div>
<div class="card" style="border-color:rgba(232,33,39,.3)"><div style="font-weight:600;margin-bottom:.3rem;color:#e82127">Tesla Map</div><div style="font-size:.72rem;color:var(--text-secondary)">구글 데이터 연동</div><div class="status status-active" style="margin-top:.3rem">구글 연동</div></div>
</div></div></div>

<!-- 구글 인증 -->
<div id="page-google-auth" class="page" style="display:none">
<div class="card google-auth-card"><div class="card-title" style="margin-bottom:.3rem">구글 비즈니스 인증</div><p style="font-size:.78rem;color:var(--text-muted);margin-bottom:.8rem">1회 점주 인증 후 XIVIX가 자동 관리합니다.</p>
<div class="guide-step"><div class="guide-num">1</div><div class="guide-text"><h4>"구글 인증 시작" 클릭</h4></div></div>
<div class="guide-step"><div class="guide-num">2</div><div class="guide-text"><h4>점주 인증코드 수신</h4></div></div>
<div class="guide-step"><div class="guide-num">3</div><div class="guide-text"><h4>"인증 완료" 클릭</h4></div></div>
</div>
<div class="card"><div class="card-title" style="margin-bottom:.8rem">인증 현황</div><table><thead><tr><th>매장</th><th>구글</th><th>네이버</th><th>관리</th></tr></thead><tbody id="authTable"></tbody></table></div></div>

<!-- 빌드 -->
<div id="page-build" class="page" style="display:none"><div class="card"><div class="card-title" style="margin-bottom:.5rem">빌드 & 배포</div><p style="font-size:.78rem;color:var(--text-muted);margin-bottom:.8rem">매장 데이터로 최적화 파일 생성 후 배포합니다.</p>
<div id="buildCfgSummary" style="font-size:.78rem;color:var(--text-secondary);margin-bottom:.8rem;padding:.6rem;background:var(--bg-input);border-radius:6px"></div>
<div style="display:flex;flex-wrap:wrap;gap:.4rem"><button class="btn btn-success btn-lg" onclick="runBuild()">빌드 실행</button><button class="btn btn-primary btn-lg" onclick="runDeploy()">빌드 + 배포</button></div></div>
<div class="card" id="buildConsole" style="display:none"><div class="card-title" style="margin-bottom:.4rem">빌드 로그</div><div class="console" id="consoleOutput"></div></div></div>

<!-- 미리보기 -->
<div id="page-preview" class="page" style="display:none"><div class="card"><div class="card-title" style="margin-bottom:.5rem">미리보기</div>
<select class="form-select" id="previewSelect" style="margin-bottom:.5rem" onchange="updatePreview()"><option value="index">브랜드 디렉토리</option></select>
<div style="border:1px solid var(--border);border-radius:8px;overflow:hidden;background:#fff"><div style="padding:1rem;color:#1f2937;min-height:250px;font-size:.82rem;line-height:1.5" id="previewContent"></div></div></div></div>

</div></div></div>
<div class="toast" id="toast"></div>
<div class="modal-overlay" id="modalOverlay"><div class="modal" id="modalContent"></div></div>
<script>
// Data
let biz=[];let cfg={domain:'brands.studioaibotbot.com',repo:'ikjoobang/xivix-tower-control',deployTarget:'github',ghToken:'',cfToken:'',cfAccount:'',crankUrl:'',defaultMaps:['google','naver','kakao']};
try{const s=localStorage.getItem('xivix_biz2');if(s)biz=JSON.parse(s);}catch(e){}
try{const c=localStorage.getItem('xivix_cfg');if(c)cfg={...cfg,...JSON.parse(c)};}catch(e){}
if(!biz.length){biz=[
{id:"gangnam-smile-dental",name:"강남스마일치과",nameEn:"Gangnam Smile Dental",type:"Dentist",category:"치과",description:"강남역 3번출구, 임플란트/교정/심미 전문. 야간(21시), 주말(토 14시).",descriptionEn:"Dental near Gangnam Stn. Implants, orthodontics.",address:"서울특별시 강남구 강남대로 396",phone:"02-555-1234",url:"https://gangnam-smile.co.kr",lat:37.4979,lng:127.0276,hours:"월~금 09:00-21:00, 토 09:00-14:00",specialties:["임플란트","교정","라미네이트"],keywords:["강남 치과","강남역 임플란트"],faq:[{q:"임플란트 비용?",a:"80만~180만원"},{q:"야간진료?",a:"월~금 21시까지"}],rating:4.8,reviewCount:324,maps:["google","naver","kakao","tmap"],googleVerified:false,naverVerified:true,crankEnabled:true,status:"active"},
{id:"yeoksam-bbq",name:"역삼숯불바베큐",nameEn:"Yeoksam Charcoal BBQ",type:"Restaurant",category:"음식점",description:"역삼동 직화 숯불구이. 한우, 갈비, 삼겹살. 단체 40명.",descriptionEn:"Charcoal BBQ. Korean beef, galbi.",address:"서울특별시 강남구 테헤란로 134",phone:"02-555-5678",url:"",lat:37.5012,lng:127.0365,hours:"매일 11:30-23:00",specialties:["한우","숯불 갈비","삼겹살"],keywords:["역삼 고기집","강남 회식"],faq:[{q:"단체 예약?",a:"40명까지, 전화 예약"}],rating:4.6,reviewCount:189,maps:["google","naver","kakao"],googleVerified:false,naverVerified:false,crankEnabled:true,status:"active"}
];sv();}
function sv(){localStorage.setItem('xivix_biz2',JSON.stringify(biz));}
function saveCfg(){cfg.domain=gi('s_domain')||cfg.domain;cfg.repo=gi('s_repo')||cfg.repo;cfg.deployTarget=gi('s_deployTarget')||cfg.deployTarget;cfg.ghToken=gi('s_ghToken')||'';cfg.cfToken=gi('s_cfToken')||'';cfg.cfAccount=gi('s_cfAccount')||'';cfg.crankUrl=gi('s_crankUrl')||'';cfg.defaultMaps=Array.from(document.querySelectorAll('.s_defMap:checked')).map(c=>c.value);localStorage.setItem('xivix_cfg',JSON.stringify(cfg));updateKeyStatus();toast('설정 저장됨');}
function loadCfg(){si('s_domain',cfg.domain);si('s_repo',cfg.repo);si('s_deployTarget',cfg.deployTarget);si('s_ghToken',cfg.ghToken);si('s_cfToken',cfg.cfToken);si('s_cfAccount',cfg.cfAccount);si('s_crankUrl',cfg.crankUrl);document.querySelectorAll('.s_defMap').forEach(c=>{c.checked=cfg.defaultMaps.includes(c.value);});updateKeyStatus();}
function updateKeyStatus(){const gh=document.getElementById('ghStatus');const cf=document.getElementById('cfStatus');if(gh)gh.innerHTML=cfg.ghToken?'<span class="key-status key-ok">연결됨</span>':'<span class="key-status key-none">미설정</span>';if(cf)cf.innerHTML=cfg.cfToken?'<span class="key-status key-ok">연결됨</span>':'<span class="key-status key-none">미설정</span>';}
function gi(id){const e=document.getElementById(id);return e?(e.tagName==='SELECT'?e.value:e.value):'';}
function si(id,v){const e=document.getElementById(id);if(e)e.value=v||'';}
function toggleShow(id){const e=document.getElementById(id);if(e)e.type=e.type==='password'?'text':'password';}
function testGH(){if(!cfg.ghToken)return toast('GitHub 토큰을 먼저 입력하세요');toast('GitHub 연결 테스트중...');fetch('https://api.github.com/user',{headers:{'Authorization':'token '+cfg.ghToken}}).then(r=>r.json()).then(d=>{if(d.login)toast('GitHub 연결 성공: '+d.login);else toast('GitHub 연결 실패');}).catch(()=>toast('GitHub 연결 실패'));}
function testCF(){if(!cfg.cfToken)return toast('Cloudflare 토큰을 먼저 입력하세요');toast('Cloudflare 연결 테스트중...');fetch('https://api.cloudflare.com/client/v4/user/tokens/verify',{headers:{'Authorization':'Bearer '+cfg.cfToken}}).then(r=>r.json()).then(d=>{if(d.success)toast('Cloudflare 연결 성공');else toast('Cloudflare 연결 실패');}).catch(()=>toast('Cloudflare 연결 실패'));}

// Mobile
function openSidebar(){document.getElementById('sidebar').classList.add('open');document.getElementById('mobileOverlay').classList.add('show');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('mobileOverlay').classList.remove('show');}

// Nav
const PT={guide:'사용 가이드',dashboard:'대시보드',add:'매장 등록',businesses:'매장 목록',maps:'지도 플랫폼','google-auth':'구글 인증',settings:'설정',build:'빌드 & 배포',preview:'미리보기'};
function go(n){closeSidebar();document.querySelectorAll('.page').forEach(p=>p.style.display='none');document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));const pg=document.getElementById('page-'+n);if(pg)pg.style.display='block';document.getElementById('pageTitle').textContent=PT[n]||n;document.querySelectorAll('.nav-item[data-page="'+n+'"]').forEach(x=>x.classList.add('active'));renderAll();if(n==='settings')loadCfg();if(n==='build')updateBuildSummary();window.scrollTo(0,0);}
function renderAll(){renderStats();renderDash();renderBizList();renderAuth();renderPrevSel();renderOpt();}
function renderStats(){const a=biz.filter(b=>b.status==='active');document.getElementById('statTotal').textContent=biz.length;document.getElementById('statActive').textContent=a.length;document.getElementById('statSEO').textContent=a.length;document.getElementById('statCrank').textContent=a.filter(b=>b.crankEnabled).length;const ms=new Set();a.forEach(b=>(b.maps||[]).forEach(m=>ms.add(m)));document.getElementById('statMaps').textContent=ms.size;}
function renderDash(){const t=document.getElementById('bizTable');if(!t)return;t.innerHTML=biz.map(b=>'<tr><td><strong>'+b.name+'</strong><br><span style="font-size:.68rem;color:var(--text-muted)">'+b.nameEn+'</span></td><td>'+b.category+'</td><td><div class="opt-indicators"><div class="opt-dot seo on"></div><div class="opt-dot aeo on"></div><div class="opt-dot geo on"></div><div class="opt-dot crank '+(b.crankEnabled?'on':'off')+'"></div><div class="opt-dot nlogic on"></div></div></td><td><span class="status status-'+(b.status==='active'?'active':'pending')+'">'+(b.status==='active'?'운영':'대기')+'</span></td><td><button class="btn btn-outline btn-sm" onclick="editBiz(\''+b.id+'\')">수정</button> <button class="btn btn-danger btn-sm" onclick="removeBiz(\''+b.id+'\')">삭제</button></td></tr>').join('');}
function renderBizList(){const t=document.getElementById('fullBizTable');if(!t)return;t.innerHTML=biz.map(b=>'<tr><td><strong>'+b.name+'</strong></td><td>'+b.category+'</td><td style="font-size:.72rem">'+b.phone+'</td><td><div class="opt-indicators"><div class="opt-dot seo on"></div><div class="opt-dot aeo on"></div><div class="opt-dot geo on"></div><div class="opt-dot crank '+(b.crankEnabled?'on':'off')+'"></div><div class="opt-dot nlogic on"></div></div></td><td><span class="status status-active">'+(b.status==='active'?'운영':'대기')+'</span></td><td><button class="btn btn-outline btn-sm" onclick="editBiz(\''+b.id+'\')">수정</button></td></tr>').join('');}
function renderAuth(){const t=document.getElementById('authTable');if(!t)return;t.innerHTML=biz.map(b=>'<tr><td><strong>'+b.name+'</strong></td><td><span class="status '+(b.googleVerified?'status-active':'status-pending')+'">'+(b.googleVerified?'완료':'미인증')+'</span></td><td><span class="status '+(b.naverVerified?'status-active':'status-pending')+'">'+(b.naverVerified?'완료':'미등록')+'</span></td><td style="display:flex;gap:.3rem;flex-wrap:wrap">'+(!b.googleVerified?'<button class="btn btn-primary btn-sm" onclick="startGV(\''+b.id+'\')">인증시작</button>':'')+'<button class="btn btn-sm '+(b.googleVerified?'btn-outline':'btn-success')+'" onclick="togV(\''+b.id+'\')">'+(b.googleVerified?'해제':'인증완료')+'</button></td></tr>').join('');}
function renderOpt(){const el=document.getElementById('optCoverage');if(!el)return;const a=biz.filter(b=>b.status==='active').length;const o=[{n:'SEO',c:'blue',v:a},{n:'AEO',c:'purple',v:a},{n:'GEO',c:'green',v:a},{n:'C-RANK',c:'amber',v:biz.filter(b=>b.crankEnabled).length},{n:'N-Logic',c:'cyan',v:a}];el.innerHTML=o.map(x=>'<div style="text-align:center"><div style="font-size:1.3rem;font-weight:700;color:var(--accent-'+x.c+');font-family:JetBrains Mono">'+x.v+'/'+a+'</div><div style="font-size:.72rem;font-weight:600">'+x.n+'</div></div>').join('');}
function renderPrevSel(){const s=document.getElementById('previewSelect');if(!s)return;s.innerHTML='<option value="index">디렉토리</option>'+biz.map(b=>'<option value="'+b.id+'">'+b.name+'</option>').join('');updatePreview();}
function updateBuildSummary(){const el=document.getElementById('buildCfgSummary');if(!el)return;el.innerHTML='배포: <strong>'+(cfg.deployTarget==='github'?'GitHub Pages':'Cloudflare')+'</strong> | 도메인: <strong>'+cfg.domain+'</strong> | 저장소: <strong>'+cfg.repo+'</strong>'+(cfg.ghToken?'':'<br><span style="color:var(--accent-red)">설정에서 GitHub 토큰을 먼저 입력하세요</span>');}

// Smart Paste
function smartParse(){const raw=document.getElementById('smartPasteInput').value.trim();if(!raw)return toast('데이터를 붙여넣으세요');const r={name:'',nameEn:'',type:'LocalBusiness',address:'',phone:'',url:'',lat:'',lng:'',hours:'',description:''};const pm=raw.match(/(0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4})/);if(pm)r.phone=pm[0];const um=raw.match(/(https?:\/\/[^\s,]+)/);if(um)r.url=um[0];const am=raw.match(/(서울|부산|대구|인천|광주|대전|울산|경기|강원|충북|충남|전북|전남|경북|경남|제주)[^\n,]*?(구|시|군)[^\n,]*?(로|길|동)\s*\d*/);if(am)r.address=am[0].trim();const cm=raw.match(/@([\d.]+),([\d.]+)/);if(cm){r.lat=cm[1];r.lng=cm[2];}const cp={Dentist:/치과|dental/i,Hospital:/병원|hospital/i,Restaurant:/맛집|식당|고기|구이/i,CafeOrCoffeeShop:/카페|커피|cafe/i,BeautySalon:/미용|헤어|뷰티/i};for(const[t,p]of Object.entries(cp)){if(p.test(raw)){r.type=t;break;}}const lines=raw.split('\n').map(l=>l.trim()).filter(Boolean);if(lines[0]){const c=lines[0].replace(/[^\w가-힣\s]/g,'').trim();if(c.length>1&&c.length<30)r.name=c;}const catMap={Dentist:'치과',Hospital:'병원',Restaurant:'음식점',CafeOrCoffeeShop:'카페',BeautySalon:'미용',LocalBusiness:'기타'};const labels={name:'매장명',nameEn:'영문명',type:'업종',address:'주소',phone:'전화',url:'웹사이트',lat:'위도',lng:'경도',hours:'운영시간',description:'설명'};document.getElementById('parsedFields').innerHTML=Object.entries(labels).map(([k,l])=>'<div class="form-group" style="margin-bottom:.4rem"><label class="form-label">'+l+(r[k]?' <span style="color:var(--accent-green)">[감지]</span>':'')+'</label>'+(k==='type'?'<select class="form-select" id="parsed_'+k+'">'+Object.entries(catMap).map(([v,n])=>'<option value="'+v+'"'+(r[k]===v?' selected':'')+'>'+n+'</option>').join('')+'</select>':'<input class="form-input" id="parsed_'+k+'" value="'+(r[k]||'')+'">')+'</div>').join('');document.getElementById('parseResult').style.display='block';toast('분류 완료');}
function confirmAdd(){const n=document.getElementById('parsed_name').value.trim();if(!n)return toast('매장명 입력');const catMap={Dentist:'치과',Hospital:'병원',Restaurant:'음식점',CafeOrCoffeeShop:'카페',BeautySalon:'미용',LocalBusiness:'기타'};const t=document.getElementById('parsed_type').value;biz.push({id:slugify(n),name:n,nameEn:document.getElementById('parsed_nameEn').value.trim()||n,type:t,category:catMap[t]||'기타',description:document.getElementById('parsed_description').value.trim(),descriptionEn:'',address:document.getElementById('parsed_address').value.trim(),phone:document.getElementById('parsed_phone').value.trim(),url:document.getElementById('parsed_url').value.trim(),lat:parseFloat(document.getElementById('parsed_lat').value)||0,lng:parseFloat(document.getElementById('parsed_lng').value)||0,hours:document.getElementById('parsed_hours').value.trim(),specialties:[],keywords:[],faq:[],rating:0,reviewCount:0,maps:cfg.defaultMaps||['google','naver','kakao'],googleVerified:false,naverVerified:false,crankEnabled:true,status:'active'});sv();renderAll();document.getElementById('parseResult').style.display='none';document.getElementById('smartPasteInput').value='';toast(n+' 등록 완료');}
function clearPaste(){document.getElementById('smartPasteInput').value='';document.getElementById('parseResult').style.display='none';}
function manualAdd(){const n=document.getElementById('f_name').value.trim();if(!n)return toast('매장명 입력');const maps=Array.from(document.querySelectorAll('#mapTargets input:checked')).map(c=>c.value);const faq=document.getElementById('f_faq').value.trim().split('\n').filter(l=>l.includes('|')).map(l=>{const[q,a]=l.split('|');return{q:q.trim(),a:a.trim()};});const catMap={Dentist:'치과',Hospital:'병원',Restaurant:'음식점',CafeOrCoffeeShop:'카페',BeautySalon:'미용',Store:'매장',EducationalOrganization:'학원',LocalBusiness:'기타'};const t=document.getElementById('f_category').value||'LocalBusiness';biz.push({id:slugify(n),name:n,nameEn:document.getElementById('f_nameEn').value.trim()||n,type:t,category:catMap[t]||'기타',description:document.getElementById('f_desc').value.trim(),descriptionEn:document.getElementById('f_descEn').value.trim(),address:document.getElementById('f_address').value.trim(),phone:document.getElementById('f_phone').value.trim(),url:document.getElementById('f_url').value.trim(),lat:parseFloat(document.getElementById('f_lat').value)||0,lng:parseFloat(document.getElementById('f_lng').value)||0,hours:document.getElementById('f_hours').value.trim(),specialties:document.getElementById('f_specialties').value.split(',').map(s=>s.trim()).filter(Boolean),keywords:document.getElementById('f_keywords').value.split(',').map(s=>s.trim()).filter(Boolean),faq,rating:0,reviewCount:0,maps,googleVerified:false,naverVerified:false,crankEnabled:true,status:'active'});sv();renderAll();toast(n+' 등록');clearManual();}
function clearManual(){['f_name','f_nameEn','f_phone','f_url','f_address','f_lat','f_lng','f_desc','f_descEn','f_hours','f_specialties','f_keywords','f_faq'].forEach(id=>{const e=document.getElementById(id);if(e)e.value='';});}

// Edit/Delete
function editBiz(id){const b=biz.find(x=>x.id===id);if(!b)return;document.getElementById('modalContent').innerHTML='<h3>'+b.name+' 수정</h3><div class="form-group"><label class="form-label">매장명</label><input class="form-input" id="e_name" value="'+b.name+'"></div><div class="form-group"><label class="form-label">영문명</label><input class="form-input" id="e_nameEn" value="'+b.nameEn+'"></div><div class="form-group"><label class="form-label">설명</label><textarea class="form-textarea" id="e_desc" style="min-height:50px">'+b.description+'</textarea></div><div class="form-group"><label class="form-label">전화</label><input class="form-input" id="e_phone" value="'+b.phone+'"></div><div class="form-group"><label class="form-label">주소</label><input class="form-input" id="e_addr" value="'+b.address+'"></div><div class="form-group"><label class="form-label">키워드</label><input class="form-input" id="e_kw" value="'+(b.keywords||[]).join(', ')+'"></div><div class="form-group"><label class="form-label">상태</label><select class="form-select" id="e_status"><option value="active"'+(b.status==='active'?' selected':'')+'>운영중</option><option value="pending"'+(b.status==='pending'?' selected':'')+'>대기</option></select></div><div style="display:flex;gap:.4rem;margin-top:1rem"><button class="btn btn-success" onclick="saveEdit(\''+id+'\')">저장</button><button class="btn btn-outline" onclick="closeModal()">취소</button></div>';document.getElementById('modalOverlay').classList.add('show');}
function saveEdit(id){const b=biz.find(x=>x.id===id);if(!b)return;b.name=gi('e_name');b.nameEn=gi('e_nameEn');b.description=gi('e_desc');b.phone=gi('e_phone');b.address=gi('e_addr');b.keywords=gi('e_kw').split(',').map(s=>s.trim()).filter(Boolean);b.status=gi('e_status');sv();renderAll();closeModal();toast('수정 완료');}
function removeBiz(id){if(!confirm('삭제?'))return;biz=biz.filter(b=>b.id!==id);sv();renderAll();toast('삭제');}
function togV(id){const b=biz.find(x=>x.id===id);if(!b)return;b.googleVerified=!b.googleVerified;sv();renderAll();toast(b.googleVerified?'인증 완료':'인증 해제');}
function startGV(id){const b=biz.find(x=>x.id===id);if(!b)return;window.open('https://business.google.com/create?hl=ko&q='+encodeURIComponent(b.name+' '+b.address),'_blank');toast('구글 비즈니스 프로필 열림');}

// Build
function runBuild(){const con=document.getElementById('buildConsole');const out=document.getElementById('consoleOutput');con.style.display='block';out.innerHTML='';const a=biz.filter(b=>b.status==='active');const lines=[{c:'c-info',t:'XIVIX Tower Control 빌드'},{c:'c-dim',t:'도메인: '+cfg.domain},{c:'c-dim',t:'매장: '+a.length+'개'},{c:'',t:''},...a.flatMap(b=>[{c:'c-ok',t:'  [OK] '+b.name+' > index.html (SEO+GEO)'},{c:'c-ok',t:'  [OK] '+b.name+' > llms.txt (AEO)'}]),{c:'',t:''},{c:'c-ok',t:'  [OK] sitemap.xml / robots.txt'},{c:'c-ok',t:'  [OK] llms.txt / crank-config.json'},{c:'',t:''},{c:'c-info',t:'빌드 완료! '+(a.length*2+4)+'개 파일'},{c:'c-ok',t:'SEO AEO GEO C-RANK N-Logic [OK]'}];let i=0;const iv=setInterval(()=>{if(i>=lines.length){clearInterval(iv);return;}out.innerHTML+='<div class="'+lines[i].c+'">'+(lines[i].t||'&nbsp;')+'</div>';out.scrollTop=out.scrollHeight;i++;},70);}
function runDeploy(){runBuild();const a=biz.filter(b=>b.status==='active');setTimeout(()=>{const out=document.getElementById('consoleOutput');const dl=[{c:'',t:''},{c:'c-info',t:'배포 시작...'},{c:'c-warn',t:'  '+cfg.domain},{c:'c-ok',t:'  [OK] 업로드'},{c:'c-ok',t:'  [OK] CDN'},{c:'c-ok',t:'  [OK] 완료!'}];let i=0;const iv=setInterval(()=>{if(i>=dl.length){clearInterval(iv);toast('배포 완료!');return;}out.innerHTML+='<div class="'+dl[i].c+'">'+(dl[i].t||'&nbsp;')+'</div>';out.scrollTop=out.scrollHeight;i++;},120);},a.length*2*70+600);}
function exportJSON(){const blob=new Blob([JSON.stringify({config:cfg,businesses:biz},null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='xivix-export.json';a.click();toast('JSON 내보내기 완료');}
function importJSON(){document.getElementById('importFile').click();}
function doImport(el){const f=el.files[0];if(!f)return;const r=new FileReader();r.onload=e=>{try{const d=JSON.parse(e.target.result);if(d.businesses){biz=d.businesses;sv();}if(d.config){cfg={...cfg,...d.config};localStorage.setItem('xivix_cfg',JSON.stringify(cfg));}renderAll();toast('가져오기 완료: '+biz.length+'개 매장');}catch(e){toast('JSON 파싱 오류');}};r.readAsText(f);}
function resetAll(){if(!confirm('모든 데이터를 초기화합니까?'))return;localStorage.removeItem('xivix_biz2');localStorage.removeItem('xivix_cfg');location.reload();}
function updatePreview(){const sel=document.getElementById('previewSelect')?.value;const el=document.getElementById('previewContent');if(!el)return;if(sel==='index'){el.innerHTML='<h2>XIVIX Brand Directory</h2><p style="color:#6b7280;margin-bottom:1rem">'+biz.filter(b=>b.status==='active').length+'개 매장</p>'+biz.filter(b=>b.status==='active').map(b=>'<div style="border:1px solid #e5e7eb;border-radius:8px;padding:.8rem;margin-bottom:.5rem"><strong>'+b.name+'</strong><br><span style="color:#6b7280;font-size:.82rem">'+b.description+'</span><br><span style="font-size:.78rem;color:#3b82f6">'+b.phone+'</span></div>').join('');}else{const b=biz.find(x=>x.id===sel);if(!b)return;el.innerHTML='<h1 style="font-size:1.2rem">'+b.name+'</h1><p style="color:#6b7280">'+b.category+'</p><p style="margin:.5rem 0">'+b.description+'</p><p>'+b.address+'</p><p>'+b.phone+'</p><p>'+b.hours+'</p>'+(b.faq?.length?'<h3 style="margin-top:.8rem">FAQ</h3>'+b.faq.map(f=>'<p><strong>Q: '+f.q+'</strong><br>A: '+f.a+'</p>').join(''):'');}}
function runDemo(){document.getElementById('demoOutput').style.display='block';const con=document.getElementById('demoConsole');con.innerHTML='';const L=[{c:'c-info',t:'=== XIVIX 데모 ==='},{c:'',t:''},{c:'c-dim',t:'[1] 매장 등록'},{c:'c-ok',t:'  강남스마일치과 (치과)'},{c:'c-ok',t:'  역삼숯불바베큐 (음식점)'},{c:'',t:''},{c:'c-dim',t:'[2] 빌드'},{c:'c-ok',t:'  [SEO] Schema.org JSON-LD'},{c:'c-ok',t:'  [AEO] llms.txt (AI 크롤러용)'},{c:'c-ok',t:'  [GEO] FAQ 리치스니펫'},{c:'c-ok',t:'  [C-RANK] 네이버 카페 연동'},{c:'c-ok',t:'  [MAP] 구글/네이버/카카오/T-MAP/테슬라'},{c:'',t:''},{c:'c-dim',t:'[3] 검색 결과'},{c:'',t:''},{c:'c-warn',t:'  "강남 치과" (구글 검색)'},{c:'c-ok',t:'  -> 강남스마일치과 리치 결과 노출'},{c:'',t:''},{c:'c-warn',t:'  "강남 좋은 치과?" (ChatGPT)'},{c:'c-ok',t:'  -> llms.txt 기반 추천'},{c:'',t:''},{c:'c-warn',t:'  "역삼 고기집" (네이버)'},{c:'c-ok',t:'  -> C-RANK로 상위 노출'},{c:'',t:''},{c:'c-info',t:'=== 완료 ==='}];let i=0;const iv=setInterval(()=>{if(i>=L.length){clearInterval(iv);return;}con.innerHTML+='<div class="'+L[i].c+'">'+(L[i].t||'&nbsp;')+'</div>';con.scrollTop=con.scrollHeight;i++;},90);}

function slugify(s){return s.replace(/[가-힣]+/g,w=>{const m={'치과':'dental','병원':'hospital','식당':'restaurant','카페':'cafe','미용':'beauty'};for(const[k,v]of Object.entries(m))if(w.includes(k))return v;return w;}).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'')||'biz-'+Date.now();}
function toast(m){const e=document.getElementById('toast');e.textContent=m;e.classList.add('show');setTimeout(()=>e.classList.remove('show'),2500);}
function closeModal(){document.getElementById('modalOverlay').classList.remove('show');}
function toggleMap(el){el.classList.toggle('selected');el.querySelector('input').checked=!el.querySelector('input').checked;}
function switchTab(t,el){document.querySelectorAll('#page-add .tab').forEach(x=>x.classList.remove('active'));el.classList.add('active');document.getElementById('addTab-paste').style.display=t==='paste'?'block':'none';document.getElementById('addTab-manual').style.display=t==='manual'?'block':'none';}
document.getElementById('modalOverlay').addEventListener('click',e=>{if(e.target===e.currentTarget)closeModal();});
renderAll();
</script>
</body>
</html>
