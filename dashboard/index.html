<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XIVIX Tower Control</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg-primary:#121212;--bg-secondary:#1e1e1e;--bg-card:#252525;--bg-input:#1a1a1a;--border:#3a3a3a;--text-primary:#e0e0e0;--text-secondary:#a0a0a0;--text-muted:#707070;--accent-blue:#5b9cf6;--accent-green:#4ade80;--accent-amber:#fbbf24;--accent-red:#f87171;--accent-purple:#c084fc;--accent-cyan:#22d3ee;--accent-pink:#f472b6}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'IBM Plex Sans KR',-apple-system,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}
.app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
.sidebar{background:var(--bg-secondary);border-right:1px solid var(--border);position:sticky;top:0;height:100vh;overflow-y:auto;display:flex;flex-direction:column;z-index:50}
.sidebar-brand{padding:1.5rem 1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.sidebar-brand h1{font-size:1.1rem;font-weight:700;letter-spacing:.05em;color:var(--accent-blue)}.sidebar-brand span{font-size:.65rem;color:var(--text-muted);display:block;margin-top:2px;letter-spacing:.1em}
.sidebar-close{display:none;background:none;border:none;color:var(--text-muted);font-size:1.3rem;cursor:pointer;padding:.3rem}
.nav-section{padding:.8rem 0}.nav-label{padding:.3rem 1.2rem;font-size:.6rem;text-transform:uppercase;letter-spacing:.12em;color:var(--text-muted);font-weight:600}
.nav-item{display:flex;align-items:center;gap:.6rem;padding:.55rem 1.2rem;cursor:pointer;font-size:.82rem;color:var(--text-secondary);transition:all .15s;border-left:3px solid transparent}
.nav-item:hover{background:rgba(91,156,246,.1);color:var(--text-primary)}.nav-item.active{background:rgba(91,156,246,.15);color:var(--accent-blue);border-left-color:var(--accent-blue);font-weight:500}
.nav-icon{width:16px;height:16px;opacity:.85;flex-shrink:0}
.opt-tags{display:flex;gap:.25rem;flex-wrap:wrap;padding:1rem 1.2rem;border-top:1px solid var(--border);margin-top:auto}
.opt-tag{font-size:.58rem;padding:.12rem .4rem;border-radius:3px;font-weight:600;letter-spacing:.05em}
.opt-tag.seo{background:rgba(91,156,246,.2);color:var(--accent-blue)}.opt-tag.aeo{background:rgba(192,132,252,.2);color:var(--accent-purple)}.opt-tag.geo{background:rgba(74,222,128,.2);color:var(--accent-green)}.opt-tag.crank{background:rgba(251,191,36,.2);color:var(--accent-amber)}.opt-tag.nlogic{background:rgba(34,211,238,.2);color:var(--accent-cyan)}
.main{overflow-y:auto}.main-header{padding:1rem 1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--bg-secondary);position:sticky;top:0;z-index:10}
.main-header h2{font-size:.95rem;font-weight:600}.header-actions{display:flex;gap:.4rem;align-items:center}
.hamburger{display:none;background:none;border:none;color:var(--text-primary);font-size:1.3rem;cursor:pointer;padding:.3rem;margin-right:.5rem}
.main-content{padding:1.2rem}
.btn{padding:.45rem .9rem;border-radius:6px;font-size:.78rem;font-weight:500;border:none;cursor:pointer;font-family:inherit;transition:all .15s;display:inline-flex;align-items:center;gap:.35rem;white-space:nowrap}
.btn-primary{background:var(--accent-blue);color:#111}.btn-primary:hover{background:#7bb3f7}.btn-success{background:var(--accent-green);color:#111}.btn-outline{background:transparent;color:var(--text-secondary);border:1px solid var(--border)}.btn-outline:hover{border-color:var(--accent-blue);color:var(--accent-blue)}.btn-danger{background:rgba(248,113,113,.18);color:var(--accent-red);border:none}.btn-sm{padding:.3rem .6rem;font-size:.72rem}.btn-lg{padding:.6rem 1.3rem;font-size:.85rem}
.btn-pink{background:var(--accent-pink);color:#111}.btn-pink:hover{background:#f9a8d4}
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1.2rem;margin-bottom:1rem}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:.4rem}.card-title{font-size:.88rem;font-weight:600}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:.7rem;margin-bottom:1.2rem}.stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:.9rem}.stat-value{font-size:1.5rem;font-weight:700;font-family:'JetBrains Mono',monospace}.stat-label{font-size:.65rem;color:var(--text-muted);margin-top:.15rem;letter-spacing:.05em}
.stat-card.blue .stat-value{color:var(--accent-blue)}.stat-card.green .stat-value{color:var(--accent-green)}.stat-card.amber .stat-value{color:var(--accent-amber)}.stat-card.purple .stat-value{color:var(--accent-purple)}.stat-card.cyan .stat-value{color:var(--accent-cyan)}.stat-card.pink .stat-value{color:var(--accent-pink)}
table{width:100%;border-collapse:collapse;font-size:.8rem}th{text-align:left;padding:.55rem .5rem;color:var(--text-secondary);font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;font-weight:600;border-bottom:2px solid var(--border)}td{padding:.6rem .5rem;border-bottom:1px solid var(--border)}tr:hover td{background:rgba(91,156,246,.06)}
.status{display:inline-block;padding:.12rem .45rem;border-radius:4px;font-size:.68rem;font-weight:600}.status-active{background:rgba(74,222,128,.2);color:var(--accent-green)}.status-pending{background:rgba(251,191,36,.2);color:var(--accent-amber)}.status-biz{background:rgba(91,156,246,.2);color:var(--accent-blue)}.status-free{background:rgba(244,114,182,.2);color:var(--accent-pink)}
.opt-indicators{display:flex;gap:.25rem}.opt-dot{width:8px;height:8px;border-radius:50%}.opt-dot.on{opacity:1}.opt-dot.off{opacity:.2}.opt-dot.seo{background:var(--accent-blue)}.opt-dot.aeo{background:var(--accent-purple)}.opt-dot.geo{background:var(--accent-green)}.opt-dot.crank{background:var(--accent-amber)}.opt-dot.nlogic{background:var(--accent-cyan)}
.form-group{margin-bottom:.9rem}.form-label{display:block;font-size:.72rem;color:var(--text-muted);margin-bottom:.25rem;font-weight:500}
.form-input,.form-textarea,.form-select{width:100%;padding:.55rem .75rem;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:.82rem;font-family:inherit;transition:border-color .15s}
.form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--accent-blue)}.form-textarea{resize:vertical;min-height:100px}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}.form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.7rem}
.map-options{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}.map-option{display:flex;align-items:center;gap:.5rem;padding:.6rem .8rem;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s}
.map-option:hover{border-color:var(--accent-blue)}.map-option.selected{border-color:var(--accent-blue);background:rgba(59,130,246,.05)}.map-option input{display:none}
.map-check{width:16px;height:16px;border:2px solid var(--border);border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.map-option.selected .map-check{background:var(--accent-blue);border-color:var(--accent-blue)}.map-option.selected .map-check::after{content:'';width:4px;height:8px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg);margin-top:-2px}
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:1rem;overflow-x:auto}.tab{padding:.55rem 1rem;font-size:.78rem;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;font-weight:500;white-space:nowrap}.tab:hover{color:var(--text-primary)}.tab.active{color:var(--accent-blue);border-bottom-color:var(--accent-blue)}
.tab.active-pink{color:var(--accent-pink);border-bottom-color:var(--accent-pink)}
.console{background:#0e0e0e;border-radius:8px;padding:1rem;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#6ee7b7;max-height:350px;overflow-y:auto;line-height:1.8;word-break:break-all}.console .c-info{color:#93c5fd}.console .c-warn{color:#fcd34d}.console .c-ok{color:#6ee7b7}.console .c-dim{color:#737373}.console .c-pink{color:#f9a8d4}
.toast{position:fixed;bottom:2rem;right:1rem;left:1rem;background:var(--bg-card);border:1px solid var(--accent-green);border-radius:8px;padding:.7rem 1.1rem;font-size:.82rem;z-index:1000;transform:translateY(100px);opacity:0;transition:all .3s;text-align:center}.toast.show{transform:translateY(0);opacity:1}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;display:none;align-items:center;justify-content:center;padding:1rem}.modal-overlay.show{display:flex}.modal{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;max-width:640px;width:100%;max-height:85vh;overflow-y:auto}.modal h3{font-size:1rem;margin-bottom:1rem}
.guide-step{display:flex;gap:1rem;padding:.8rem 0;border-bottom:1px solid rgba(42,53,72,.4)}.guide-step:last-child{border-bottom:none}.guide-num{width:28px;height:28px;border-radius:50%;background:rgba(59,130,246,.15);color:var(--accent-blue);display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:700;flex-shrink:0;font-family:'JetBrains Mono'}
.guide-text h4{font-size:.85rem;font-weight:600;margin-bottom:.2rem}.guide-text p{font-size:.78rem;color:var(--text-secondary);line-height:1.5}.guide-text code{background:rgba(91,156,246,.15);color:var(--accent-blue);padding:.1rem .3rem;border-radius:3px;font-size:.72rem;font-family:'JetBrains Mono'}
.flow-branch{display:grid;grid-template-columns:repeat(5,1fr);gap:.5rem;margin-top:.3rem}.flow-box{padding:.5rem .6rem;border-radius:6px;font-size:.7rem;font-weight:500;text-align:center}
.setting-section{margin-bottom:1.2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}.setting-section:last-child{border-bottom:none}
.setting-title{font-size:.82rem;font-weight:600;margin-bottom:.6rem;display:flex;align-items:center;gap:.4rem}
.api-key-input{font-family:'JetBrains Mono',monospace;font-size:.75rem}
.key-status{display:inline-flex;align-items:center;gap:.3rem;font-size:.68rem;padding:.2rem .5rem;border-radius:4px;margin-left:.5rem}
.key-ok{background:rgba(74,222,128,.18);color:var(--accent-green)}.key-none{background:rgba(248,113,113,.18);color:var(--accent-red)}
.mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:40}
.sns-row{display:flex;gap:.4rem;align-items:center;margin-bottom:.4rem}.sns-row .form-input{flex:1}.sns-label{min-width:60px;font-size:.72rem;font-weight:600;color:var(--text-muted)}
.sns-link{display:inline-flex;align-items:center;gap:.3rem;padding:.15rem .4rem;border-radius:4px;font-size:.65rem;font-weight:500;text-decoration:none;transition:opacity .15s}.sns-link:hover{opacity:.8}
.sns-link.insta{background:rgba(225,48,108,.2);color:#f472b6}.sns-link.youtube{background:rgba(255,0,0,.18);color:#fca5a5}.sns-link.blog{background:rgba(3,199,90,.18);color:#6ee7b7}.sns-link.kakao{background:rgba(254,229,0,.2);color:#fde047}.sns-link.tiktok{background:rgba(255,255,255,.1);color:#e0e0e0}.sns-link.facebook{background:rgba(24,119,242,.18);color:#93c5fd}.sns-link.other{background:rgba(91,156,246,.15);color:var(--accent-blue)}
.mode-toggle{display:flex;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;overflow:hidden;margin-bottom:1rem}.mode-btn{flex:1;padding:.6rem;text-align:center;font-size:.82rem;font-weight:500;cursor:pointer;border:none;background:transparent;color:var(--text-muted);font-family:inherit;transition:all .15s}.mode-btn.active-biz{background:rgba(91,156,246,.2);color:var(--accent-blue)}.mode-btn.active-free{background:rgba(244,114,182,.2);color:var(--accent-pink)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@media(max-width:768px){
.app{grid-template-columns:1fr}
.sidebar{position:fixed;left:-260px;width:260px;height:100vh;transition:left .3s;z-index:50}.sidebar.open{left:0}.sidebar-close{display:block}
.mobile-overlay.show{display:block}.hamburger{display:block}
.stats-grid{grid-template-columns:repeat(2,1fr)}
.form-row,.form-row-3,.map-options{grid-template-columns:1fr}
.flow-branch{grid-template-columns:repeat(3,1fr)}
.stat-value{font-size:1.2rem}
table{font-size:.72rem;display:block;overflow-x:auto}
.main-content{padding:.8rem}.card{padding:.9rem}
.toast{left:.5rem;right:.5rem}
}
@media(max-width:400px){.stats-grid{grid-template-columns:1fr 1fr}.flow-branch{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<div class="app">
<div class="mobile-overlay" id="mobileOverlay" onclick="closeSidebar()"></div>
<aside class="sidebar" id="sidebar">
<div class="sidebar-brand"><div><h1>XIVIX</h1><span>Tower Control v2.0</span></div><button class="sidebar-close" onclick="closeSidebar()">X</button></div>
<div class="nav-section">
<div class="nav-label">관리</div>
<div class="nav-item active" data-page="guide" onclick="go('guide')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>사용 가이드</div>
<div class="nav-item" data-page="dashboard" onclick="go('dashboard')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>대시보드</div>
<div class="nav-item" data-page="add-biz" onclick="go('add-biz')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/></svg>매장 등록</div>
<div class="nav-item" data-page="add-free" onclick="go('add-free')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>프리랜서 등록</div>
<div class="nav-item" data-page="list" onclick="go('list')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>전체 목록</div>
</div>
<div class="nav-section">
<div class="nav-label">시스템</div>
<div class="nav-item" data-page="settings" onclick="go('settings')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>설정</div>
<div class="nav-item" data-page="build" onclick="go('build')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>빌드 & 배포</div>
<div class="nav-item" data-page="preview" onclick="go('preview')"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>미리보기</div>
</div>
<div class="opt-tags"><span class="opt-tag seo">SEO</span><span class="opt-tag aeo">AEO</span><span class="opt-tag geo">GEO</span><span class="opt-tag crank">C-RANK</span><span class="opt-tag nlogic">N-LOGIC</span></div>
</aside>
<div class="main">
<div class="main-header"><div style="display:flex;align-items:center"><button class="hamburger" onclick="openSidebar()">&#9776;</button><h2 id="pageTitle">사용 가이드</h2></div><div class="header-actions"><button class="btn btn-outline btn-sm" onclick="go('settings')">설정</button><button class="btn btn-primary btn-sm" onclick="go('build')">빌드</button></div></div>
<div class="main-content">

<!-- 가이드 -->
<div id="page-guide" class="page">
<div class="card"><div class="card-title" style="margin-bottom:.3rem">XIVIX Tower Control</div><p style="font-size:.82rem;color:var(--text-secondary);line-height:1.6"><strong>매장</strong> 또는 <strong>프리랜서(개인 브랜드)</strong> 정보를 등록하면, 구글/네이버/카카오/AI 검색에 최적화된 페이지가 자동 생성됩니다.</p></div>
<div class="card"><div class="card-title" style="margin-bottom:.5rem">두 가지 모드</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-top:.5rem">
<div style="padding:.8rem;border-radius:8px;border:1px solid rgba(59,130,246,.3);background:rgba(59,130,246,.04)"><div style="font-weight:600;color:var(--accent-blue);margin-bottom:.3rem">매장 모드</div><div style="font-size:.75rem;color:var(--text-secondary);line-height:1.5">치과, 병원, 음식점, 카페 등<br>고정 주소 + 지도 노출<br>Schema: LocalBusiness</div><button class="btn btn-primary btn-sm" style="margin-top:.5rem" onclick="go('add-biz')">매장 등록</button></div>
<div style="padding:.8rem;border-radius:8px;border:1px solid rgba(236,72,153,.3);background:rgba(236,72,153,.04)"><div style="font-weight:600;color:var(--accent-pink);margin-bottom:.3rem">프리랜서 모드</div><div style="font-size:.75rem;color:var(--text-secondary);line-height:1.5">보험설계사, 자동차딜러, 부동산중개<br>SNS 채널 + 키워드 노출<br>Schema: Person + Service</div><button class="btn btn-pink btn-sm" style="margin-top:.5rem" onclick="go('add-free')">프리랜서 등록</button></div>
</div></div>
<div class="card"><div class="card-title" style="margin-bottom:.8rem">등록 후 자동 생성물</div>
<div style="background:var(--bg-input);border-radius:8px;padding:1rem">
<div class="flow-branch">
<div class="flow-box" style="background:rgba(59,130,246,.12);color:var(--accent-blue);font-size:.65rem"><strong>SEO</strong><br>Schema.org<br>sitemap</div>
<div class="flow-box" style="background:rgba(168,85,247,.12);color:var(--accent-purple);font-size:.65rem"><strong>AEO</strong><br>llms.txt<br>AI 답변용</div>
<div class="flow-box" style="background:rgba(34,197,94,.12);color:var(--accent-green);font-size:.65rem"><strong>GEO</strong><br>FAQ 리치<br>AI Overview</div>
<div class="flow-box" style="background:rgba(245,158,11,.12);color:var(--accent-amber);font-size:.65rem"><strong>C-RANK</strong><br>네이버 카페<br>블로그</div>
<div class="flow-box" style="background:rgba(6,182,212,.12);color:var(--accent-cyan);font-size:.65rem"><strong>N-LOGIC</strong><br>네이버 검색<br>메타태그</div>
</div></div></div>
<div class="card"><div class="card-title" style="margin-bottom:.5rem">프리랜서 vs 매장 차이</div>
<table><thead><tr><th></th><th>매장</th><th>프리랜서</th></tr></thead><tbody>
<tr><td style="font-weight:600">정체</td><td>LocalBusiness (장소)</td><td>Person + ProfessionalService</td></tr>
<tr><td style="font-weight:600">위치</td><td>고정 주소 + 지도</td><td>활동 지역 (강남/분당 등)</td></tr>
<tr><td style="font-weight:600">노출 채널</td><td>구글맵/네이버지도</td><td>인스타/유튜브/블로그/카카오</td></tr>
<tr><td style="font-weight:600">키워드</td><td>"강남 치과"</td><td>"강남 보험설계사 추천"</td></tr>
<tr><td style="font-weight:600">AEO</td><td>"근처 치과 추천"</td><td>"좋은 보험설계사 찾는법"</td></tr>
<tr><td style="font-weight:600">빌드 결과</td><td>매장 페이지 + 지도</td><td>링크허브 + SNS 프로필</td></tr>
</tbody></table></div>
<div class="card"><button class="btn btn-primary btn-lg" onclick="runDemo()">데모 실행</button><div id="demoOutput" style="margin-top:1rem;display:none"><div class="console" id="demoConsole"></div></div></div>
</div>

<!-- 대시보드 -->
<div id="page-dashboard" class="page" style="display:none">
<div class="stats-grid" id="statsGrid"></div>
<div class="card"><div class="card-header"><span class="card-title">전체 관리 현황</span><div style="display:flex;gap:.3rem"><button class="btn btn-primary btn-sm" onclick="go('add-biz')">+ 매장</button><button class="btn btn-pink btn-sm" onclick="go('add-free')">+ 프리랜서</button></div></div>
<table><thead><tr><th>이름</th><th>유형</th><th>업종</th><th>최적화</th><th>상태</th><th></th></tr></thead><tbody id="dashTable"></tbody></table></div>
</div>

<!-- 매장 등록 -->
<div id="page-add-biz" class="page" style="display:none">
<div class="card" style="border-color:rgba(59,130,246,.3)"><div class="card-title" style="color:var(--accent-blue);margin-bottom:.3rem">매장 등록</div><p style="font-size:.78rem;color:var(--text-muted)">고정 위치가 있는 사업체 (치과, 병원, 음식점 등)</p></div>
<div class="tabs"><div class="tab active" onclick="switchBizTab('search',this)">매장 검색</div><div class="tab" onclick="switchBizTab('paste',this)">Smart Paste</div><div class="tab" onclick="switchBizTab('manual',this)">직접 입력</div></div>
<div id="bizTab-search"><div class="card"><div class="card-title" style="margin-bottom:.4rem">매장명으로 검색</div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.5rem">구글/네이버에서 보이는 그 매장 정보를 카카오 API로 가져옵니다. (설정에서 API 키 등록 필요)</p>
<div style="display:flex;gap:.4rem"><input class="form-input" id="searchQ" placeholder="매장명 + 지역 (예: 라온뷰티 병점)" style="flex:1" onkeydown="if(event.key==='Enter')doSearchAdd()"><button class="btn btn-primary btn-lg" onclick="doSearchAdd()">검색</button></div>
<div id="searchResult" style="margin-top:.6rem;max-height:400px;overflow-y:auto"></div></div></div>
<div id="bizTab-paste" style="display:none"><div class="card"><textarea id="smartPasteInput" class="form-textarea" style="min-height:130px;font-family:'JetBrains Mono',monospace;font-size:.75rem" placeholder="예시:&#10;강남스마일치과&#10;서울 강남구 강남대로 396&#10;02-555-1234&#10;https://gangnam-smile.co.kr&#10;&#10;※ URL만 넣으면 이름/주소 자동 감지가 안됩니다.&#10;매장 정보를 텍스트로 함께 붙여넣어주세요."></textarea><div style="margin-top:.5rem"><button class="btn btn-primary" onclick="smartParse()">자동 분류</button></div></div><div id="parseResult" style="display:none"><div class="card" style="border-color:var(--accent-green)"><div id="parsedFields"></div><div style="margin-top:.8rem;display:flex;gap:.4rem"><button class="btn btn-success" onclick="confirmAdd()">등록</button><button class="btn btn-outline" onclick="document.getElementById('parseResult').style.display='none'">취소</button></div></div></div></div>
<div id="bizTab-manual" style="display:none"><div class="card" style="border-color:rgba(91,156,246,.3);margin-bottom:.5rem">
<div class="card-title" style="margin-bottom:.4rem">매장 검색</div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.4rem">매장명 검색 → 원클릭 자동 입력 (설정에서 카카오 API 키 등록 필요)</p>
<div style="display:flex;gap:.4rem"><input class="form-input" id="kakaoSearchQ" placeholder="매장명 검색 (예: 라온뷰티 병점)" style="flex:1" onkeydown="if(event.key==='Enter')kakaoSearch(gi('kakaoSearchQ'),'kakaoSearchResult')"><button class="btn btn-primary" onclick="kakaoSearch(gi('kakaoSearchQ'),'kakaoSearchResult')">검색</button></div>
<div id="kakaoSearchResult" style="margin-top:.4rem;max-height:250px;overflow-y:auto"></div>
</div><div class="card">
<div class="form-row"><div class="form-group"><label class="form-label">매장명</label><input class="form-input" id="f_name" placeholder="강남스마일치과"></div><div class="form-group"><label class="form-label">영문명</label><input class="form-input" id="f_nameEn" placeholder="Gangnam Smile Dental"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">업종</label><select class="form-select" id="f_category"><option value="">선택</option><option value="Dentist">치과</option><option value="Hospital">병원</option><option value="Restaurant">음식점</option><option value="CafeOrCoffeeShop">카페</option><option value="BeautySalon">미용</option><option value="Store">매장</option><option value="LocalBusiness">기타</option></select></div><div class="form-group"><label class="form-label">전화</label><input class="form-input" id="f_phone" placeholder="02-555-1234"></div></div>
<div class="form-group"><label class="form-label">주소</label><div style="display:flex;gap:.4rem"><input class="form-input" id="f_address" placeholder="서울 강남구 강남대로 396" style="flex:1"><button class="btn btn-outline btn-sm" onclick="geocode('f_address','f_lat','f_lng','f_geo_status')" type="button">좌표 검색</button></div><span id="f_geo_status" style="font-size:.68rem;margin-top:.2rem;display:block"></span><input type="hidden" id="f_lat"><input type="hidden" id="f_lng"></div>
<div class="form-group"><label class="form-label">웹사이트</label><input class="form-input" id="f_url" placeholder="https://"></div>
<div class="form-group"><label class="form-label">설명</label><textarea class="form-textarea" id="f_desc" style="min-height:50px" placeholder="매장 설명"></textarea></div>
<div class="form-group"><label class="form-label">운영시간</label><input class="form-input" id="f_hours" placeholder="월~금 09:00-21:00"></div>
<div class="form-group"><label class="form-label">키워드 (쉼표)</label><input class="form-input" id="f_keywords" placeholder="강남 치과, 임플란트"></div>
<div class="form-group"><label class="form-label">FAQ (질문|답변, 줄마다)</label><textarea class="form-textarea" id="f_faq" style="min-height:50px" placeholder="비용?|80만~180만원"></textarea></div>
<div style="margin-top:.8rem"><button class="btn btn-success btn-lg" onclick="manualAddBiz()">매장 등록</button></div>
</div></div>
</div>

<!-- 프리랜서 등록 -->
<div id="page-add-free" class="page" style="display:none">
<div class="card" style="border-color:rgba(236,72,153,.3)"><div class="card-title" style="color:var(--accent-pink);margin-bottom:.3rem">프리랜서 등록</div><p style="font-size:.78rem;color:var(--text-muted)">보험설계사, 자동차딜러, 부동산중개사, 영업사원 등 개인 브랜드</p></div>
<div class="card">
<div class="card-title" style="margin-bottom:.8rem">기본 정보</div>
<div class="form-row"><div class="form-group"><label class="form-label">이름 (활동명)</label><input class="form-input" id="fl_name" placeholder="김보험"></div><div class="form-group"><label class="form-label">영문명</label><input class="form-input" id="fl_nameEn" placeholder="Kim Insurance Pro"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">직종</label><select class="form-select" id="fl_job"><option value="InsuranceAgent">보험설계사</option><option value="CarDealer">자동차딜러</option><option value="RealEstateAgent">부동산중개사</option><option value="FinancialAdvisor">재무설계사</option><option value="SalesAgent">영업사원</option><option value="Freelancer">프리랜서 기타</option></select></div><div class="form-group"><label class="form-label">소속/회사</label><input class="form-input" id="fl_company" placeholder="삼성생명, 메르세데스벤츠 강남 등"></div></div>
<div class="form-group"><label class="form-label">전화</label><input class="form-input" id="fl_phone" placeholder="010-1234-5678"></div>
<div class="form-group"><label class="form-label">활동 지역 (쉼표 구분)</label><input class="form-input" id="fl_areas" placeholder="강남, 서초, 분당, 판교"></div>
<div class="form-group"><label class="form-label">한줄 소개</label><input class="form-input" id="fl_tagline" placeholder="15년차 보험 전문가, 맞춤 설계"></div>
<div class="form-group"><label class="form-label">상세 소개</label><textarea class="form-textarea" id="fl_desc" style="min-height:60px" placeholder="경력, 전문 분야, 차별점 등"></textarea></div>
</div>
<div class="card">
<div class="card-title" style="margin-bottom:.8rem">SNS 채널</div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.6rem">운영중인 채널 URL을 입력하세요. 빈칸은 무시됩니다.</p>
<div class="sns-row"><span class="sns-label" style="color:#e1306c">인스타그램</span><input class="form-input" id="fl_insta" placeholder="https://instagram.com/username"></div>
<div class="sns-row"><span class="sns-label" style="color:#ff0000">유튜브</span><input class="form-input" id="fl_youtube" placeholder="https://youtube.com/@channel"></div>
<div class="sns-row"><span class="sns-label" style="color:#03c75a">네이버블로그</span><input class="form-input" id="fl_blog" placeholder="https://blog.naver.com/id"></div>
<div class="sns-row"><span class="sns-label" style="color:#b8a800">카카오채널</span><input class="form-input" id="fl_kakao" placeholder="https://pf.kakao.com/_xxxxx"></div>
<div class="sns-row"><span class="sns-label" style="color:#fff">틱톡</span><input class="form-input" id="fl_tiktok" placeholder="https://tiktok.com/@username"></div>
<div class="sns-row"><span class="sns-label" style="color:#1877f2">페이스북</span><input class="form-input" id="fl_facebook" placeholder="https://facebook.com/page"></div>
<div class="sns-row"><span class="sns-label" style="color:var(--accent-blue)">기타 링크</span><input class="form-input" id="fl_other" placeholder="오픈채팅, 홈페이지 등"></div>
</div>
<div class="card">
<div class="card-title" style="margin-bottom:.8rem">전문성 & 키워드</div>
<div class="form-group"><label class="form-label">자격증 / 수상 (줄마다 1개)</label><textarea class="form-textarea" id="fl_certs" style="min-height:50px" placeholder="손해사정사 자격증&#10;MDRT 2024&#10;보험왕 수상 2023"></textarea></div>
<div class="form-group"><label class="form-label">전문 분야 (쉼표)</label><input class="form-input" id="fl_specialties" placeholder="변액보험, 종신보험, 연금저축"></div>
<div class="form-group"><label class="form-label">검색 키워드 (쉼표)</label><input class="form-input" id="fl_keywords" placeholder="강남 보험설계사, 변액보험 추천, 보험 상담"></div>
<div class="form-group"><label class="form-label">FAQ (질문|답변, 줄마다)</label><textarea class="form-textarea" id="fl_faq" style="min-height:50px" placeholder="상담비용?|무료 상담&#10;어떤보험?|맞춤 설계 후 추천"></textarea></div>
</div>
<div style="display:flex;gap:.4rem"><button class="btn btn-pink btn-lg" onclick="addFreelancer()">프리랜서 등록</button><button class="btn btn-outline" onclick="clearFreeForm()">초기화</button></div>
</div>

<!-- 전체 목록 -->
<div id="page-list" class="page" style="display:none"><div class="card"><div class="card-header"><span class="card-title">전체 목록</span><button class="btn btn-outline btn-sm" onclick="exportJSON()">JSON</button></div>
<table><thead><tr><th>이름</th><th>유형</th><th>업종/직종</th><th>채널</th><th>상태</th><th></th></tr></thead><tbody id="fullTable"></tbody></table></div></div>

<!-- 설정 -->
<div id="page-settings" class="page" style="display:none">
<div class="card"><div class="card-title" style="margin-bottom:1rem">시스템 설정</div>
<div class="setting-section"><div class="setting-title">카카오 로컬 API <span id="kakaoStatus"></span></div>
<p style="font-size:.72rem;color:var(--text-muted);margin-bottom:.4rem">매장명 검색 → 주소/전화/좌표 자동 입력. <a href="https://developers.kakao.com/" target="_blank" style="color:var(--accent-blue)">developers.kakao.com</a> 에서 무료 앱 키 발급</p>
<div class="form-group"><input class="form-input api-key-input" id="s_kakaoKey" type="password" placeholder="REST API 키 (KakaoAK 없이 키만)" onblur="saveCfg()"></div>
<div style="display:flex;gap:.3rem"><button class="btn btn-outline btn-sm" onclick="toggleShow('s_kakaoKey')">보기/숨기기</button><button class="btn btn-primary btn-sm" onclick="testKakao()">테스트</button></div></div>
<div class="setting-section"><div class="setting-title">배포</div>
<div class="form-row"><div class="form-group"><label class="form-label">배포 대상</label><select class="form-select" id="s_deployTarget" onchange="saveCfg()"><option value="github">GitHub Pages</option><option value="cloudflare">Cloudflare Pages</option></select></div><div class="form-group"><label class="form-label">도메인</label><input class="form-input" id="s_domain" placeholder="brands.studioaibotbot.com" onblur="saveCfg()"></div></div>
<div class="form-group"><label class="form-label">GitHub 저장소</label><input class="form-input" id="s_repo" placeholder="ikjoobang/xivix-tower-control" onblur="saveCfg()"></div></div>
<div class="setting-section"><div class="setting-title">GitHub API 토큰 <span id="ghStatus"></span></div>
<div class="form-group"><input class="form-input api-key-input" id="s_ghToken" type="password" placeholder="ghp_xxxx" onblur="saveCfg()"></div>
<div style="display:flex;gap:.3rem"><button class="btn btn-outline btn-sm" onclick="toggleShow('s_ghToken')">보기/숨기기</button><button class="btn btn-primary btn-sm" onclick="testGH()">테스트</button></div></div>
<div class="setting-section"><div class="setting-title">데이터</div>
<div style="display:flex;flex-wrap:wrap;gap:.3rem"><button class="btn btn-outline" onclick="exportJSON()">JSON 내보내기</button><button class="btn btn-outline" onclick="document.getElementById('importFile').click()">JSON 가져오기</button><button class="btn btn-danger" onclick="resetAll()">전체 초기화</button></div>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="doImport(this)"></div>
</div></div>

<!-- 빌드 -->
<div id="page-build" class="page" style="display:none"><div class="card"><div class="card-title" style="margin-bottom:.5rem">빌드 & 배포</div>
<div id="buildSummary" style="font-size:.78rem;color:var(--text-secondary);margin-bottom:.8rem;padding:.6rem;background:var(--bg-input);border-radius:6px"></div>
<div style="display:flex;flex-wrap:wrap;gap:.4rem"><button class="btn btn-success btn-lg" onclick="runBuild()">빌드 실행</button><button class="btn btn-primary btn-lg" onclick="runDeploy()">빌드 + 배포</button></div></div>
<div class="card" id="buildConsole" style="display:none"><div class="card-title" style="margin-bottom:.4rem">빌드 로그</div><div class="console" id="consoleOutput"></div></div></div>

<!-- 미리보기 -->
<div id="page-preview" class="page" style="display:none"><div class="card"><div class="card-title" style="margin-bottom:.5rem">미리보기</div>
<select class="form-select" id="previewSelect" style="margin-bottom:.5rem" onchange="updatePreview()"></select>
<div style="border:1px solid var(--border);border-radius:8px;overflow:hidden;background:#fff"><div style="padding:1rem;color:#1f2937;min-height:250px;font-size:.82rem;line-height:1.5" id="previewContent"></div></div></div></div>

</div></div></div>
<div class="toast" id="toast"></div>
<div class="modal-overlay" id="modalOverlay"><div class="modal" id="modalContent"></div></div>
<script>
let biz=[];let free=[];let cfg={domain:'brands.studioaibotbot.com',repo:'ikjoobang/xivix-tower-control',deployTarget:'github',ghToken:'',kakaoKey:''};
try{biz=JSON.parse(localStorage.getItem('xivix_biz3'))||[];}catch(e){}
try{free=JSON.parse(localStorage.getItem('xivix_free'))||[];}catch(e){}
try{cfg={...cfg,...JSON.parse(localStorage.getItem('xivix_cfg2'))};}catch(e){}
if(!biz.length&&!free.length){
biz=[{id:"gangnam-dental",name:"강남스마일치과",nameEn:"Gangnam Smile Dental",type:"Dentist",category:"치과",description:"강남역 3번출구, 임플란트/교정 전문",address:"서울 강남구 강남대로 396",phone:"02-555-1234",url:"https://gangnam-smile.co.kr",lat:37.4979,lng:127.0276,hours:"월~금 09:00-21:00",keywords:["강남 치과","임플란트"],faq:[{q:"임플란트 비용?",a:"80만~180만원"}],maps:["google","naver","kakao"],status:"active",crankEnabled:true}];
free=[{id:"kim-insurance",name:"김보험프로",nameEn:"Kim Insurance Pro",job:"InsuranceAgent",jobLabel:"보험설계사",company:"삼성생명 강남지점",phone:"010-1234-5678",areas:["강남","서초","분당"],tagline:"15년차 보험 전문가, 맞춤 설계",description:"MDRT 5회 달성. 변액보험/종신보험/연금저축 전문. 고객 800명 관리중.",sns:{instagram:"https://instagram.com/kim_insurance",youtube:"https://youtube.com/@kim-insurance",blog:"https://blog.naver.com/kim_insurance",kakao:"https://pf.kakao.com/_kim",tiktok:"",facebook:"",other:""},certs:["손해사정사","MDRT 2024","보험왕 2023"],specialties:["변액보험","종신보험","연금저축","실손보험"],keywords:["강남 보험설계사","변액보험 추천","보험 상담 무료"],faq:[{q:"상담 비용?",a:"무료 상담"},{q:"어떤 보험?",a:"맞춤 설계 후 추천"}],status:"active",crankEnabled:true}];
svBiz();svFree();
}
function svBiz(){localStorage.setItem('xivix_biz3',JSON.stringify(biz));}
function svFree(){localStorage.setItem('xivix_free',JSON.stringify(free));}
function saveCfg(){cfg.domain=gi('s_domain')||cfg.domain;cfg.repo=gi('s_repo')||cfg.repo;cfg.deployTarget=gi('s_deployTarget');cfg.ghToken=gi('s_ghToken');cfg.kakaoKey=gi('s_kakaoKey');localStorage.setItem('xivix_cfg2',JSON.stringify(cfg));toast('설정 저장');}
function loadCfg(){si('s_domain',cfg.domain);si('s_repo',cfg.repo);si('s_deployTarget',cfg.deployTarget);si('s_ghToken',cfg.ghToken);si('s_kakaoKey',cfg.kakaoKey);const gh=document.getElementById('ghStatus');if(gh)gh.innerHTML=cfg.ghToken?'<span class="key-status key-ok">연결됨</span>':'<span class="key-status key-none">미설정</span>';const kk=document.getElementById('kakaoStatus');if(kk)kk.innerHTML=cfg.kakaoKey?'<span class="key-status key-ok">설정됨</span>':'<span class="key-status key-none">미설정</span>';}
function gi(id){const e=document.getElementById(id);return e?e.value:'';}
function si(id,v){const e=document.getElementById(id);if(e)e.value=v||'';}
function toggleShow(id){const e=document.getElementById(id);if(e)e.type=e.type==='password'?'text':'password';}
function testGH(){if(!cfg.ghToken)return toast('토큰 먼저 입력');fetch('https://api.github.com/user',{headers:{Authorization:'token '+cfg.ghToken}}).then(r=>r.json()).then(d=>toast(d.login?'연결 성공: '+d.login:'실패')).catch(()=>toast('실패'));}
function openSidebar(){document.getElementById('sidebar').classList.add('open');document.getElementById('mobileOverlay').classList.add('show');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('mobileOverlay').classList.remove('show');}
const PT={guide:'사용 가이드',dashboard:'대시보드','add-biz':'매장 등록','add-free':'프리랜서 등록',list:'전체 목록',settings:'설정',build:'빌드 & 배포',preview:'미리보기'};
function go(n){closeSidebar();document.querySelectorAll('.page').forEach(p=>p.style.display='none');document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));const pg=document.getElementById('page-'+n);if(pg)pg.style.display='block';document.getElementById('pageTitle').textContent=PT[n]||n;document.querySelectorAll('.nav-item[data-page="'+n+'"]').forEach(x=>x.classList.add('active'));renderAll();if(n==='settings')loadCfg();if(n==='build')updateBuildSummary();window.scrollTo(0,0);}
function renderAll(){renderStats();renderDash();renderFullList();renderPrevSel();}
const jobMap={InsuranceAgent:'보험설계사',CarDealer:'자동차딜러',RealEstateAgent:'부동산중개사',FinancialAdvisor:'재무설계사',SalesAgent:'영업사원',Freelancer:'프리랜서'};
const catMap={Dentist:'치과',Hospital:'병원',Restaurant:'음식점',CafeOrCoffeeShop:'카페',BeautySalon:'미용',Store:'매장',LocalBusiness:'기타'};
function renderStats(){const sg=document.getElementById('statsGrid');if(!sg)return;sg.innerHTML='<div class="stat-card blue"><div class="stat-value">'+(biz.length+free.length)+'</div><div class="stat-label">전체 등록</div></div><div class="stat-card green"><div class="stat-value">'+biz.filter(b=>b.status==='active').length+'</div><div class="stat-label">매장</div></div><div class="stat-card pink"><div class="stat-value">'+free.filter(f=>f.status==='active').length+'</div><div class="stat-label">프리랜서</div></div><div class="stat-card purple"><div class="stat-value">'+(biz.length+free.length)+'</div><div class="stat-label">SEO</div></div><div class="stat-card amber"><div class="stat-value">'+[...biz,...free].filter(x=>x.crankEnabled).length+'</div><div class="stat-label">C-RANK</div></div><div class="stat-card cyan"><div class="stat-value">'+countSNS()+'</div><div class="stat-label">SNS 채널</div></div>';}
function countSNS(){let c=0;free.forEach(f=>{if(f.sns)Object.values(f.sns).forEach(v=>{if(v)c++;});});return c;}
function snsIcons(sns){if(!sns)return'-';return Object.entries(sns).filter(([k,v])=>v).map(([k,v])=>{const cls={instagram:'insta',youtube:'youtube',blog:'blog',kakao:'kakao',tiktok:'tiktok',facebook:'facebook',other:'other'};return'<a href="'+v+'" target="_blank" class="sns-link '+(cls[k]||'other')+'">'+k.slice(0,2).toUpperCase()+'</a>';}).join(' ')||'-';}
function renderDash(){const t=document.getElementById('dashTable');if(!t)return;let h='';biz.forEach(b=>{h+='<tr><td><strong>'+b.name+'</strong></td><td><span class="status status-biz">매장</span></td><td>'+(b.category||catMap[b.type]||'')+'</td><td><div class="opt-indicators"><div class="opt-dot seo on"></div><div class="opt-dot aeo on"></div><div class="opt-dot geo on"></div><div class="opt-dot crank '+(b.crankEnabled?'on':'off')+'"></div><div class="opt-dot nlogic on"></div></div></td><td><span class="status status-active">운영</span></td><td><button class="btn btn-outline btn-sm" onclick="editBiz(\''+b.id+'\')">수정</button> <button class="btn btn-danger btn-sm" onclick="removeBiz(\''+b.id+'\')">삭제</button></td></tr>';});
free.forEach(f=>{h+='<tr><td><strong>'+f.name+'</strong></td><td><span class="status status-free">프리랜서</span></td><td>'+(f.jobLabel||jobMap[f.job]||'')+'</td><td>'+snsIcons(f.sns)+'</td><td><span class="status status-active">운영</span></td><td><button class="btn btn-outline btn-sm" onclick="editFree(\''+f.id+'\')">수정</button> <button class="btn btn-danger btn-sm" onclick="removeFree(\''+f.id+'\')">삭제</button></td></tr>';});t.innerHTML=h;}
function renderFullList(){const t=document.getElementById('fullTable');if(!t)return;let h='';biz.forEach(b=>{h+='<tr><td><strong>'+b.name+'</strong></td><td><span class="status status-biz">매장</span></td><td>'+(b.category||'')+'</td><td>'+b.phone+'</td><td><span class="status status-active">운영</span></td><td><button class="btn btn-outline btn-sm" onclick="editBiz(\''+b.id+'\')">수정</button></td></tr>';});
free.forEach(f=>{h+='<tr><td><strong>'+f.name+'</strong></td><td><span class="status status-free">프리랜서</span></td><td>'+(f.jobLabel||'')+'</td><td>'+snsIcons(f.sns)+'</td><td><span class="status status-active">운영</span></td><td><button class="btn btn-outline btn-sm" onclick="editFree(\''+f.id+'\')">수정</button></td></tr>';});t.innerHTML=h;}
function updateBuildSummary(){const el=document.getElementById('buildSummary');if(!el)return;el.innerHTML='매장: <strong>'+biz.length+'</strong> | 프리랜서: <strong>'+free.length+'</strong> | 도메인: <strong>'+cfg.domain+'</strong>';}
// Smart Paste (biz)
function switchBizTab(t,el){document.querySelectorAll('#page-add-biz .tab').forEach(x=>x.classList.remove('active'));el.classList.add('active');document.getElementById('bizTab-search').style.display=t==='search'?'block':'none';document.getElementById('bizTab-paste').style.display=t==='paste'?'block':'none';document.getElementById('bizTab-manual').style.display=t==='manual'?'block':'none';}
function smartParse(){const raw=gi('smartPasteInput').trim();if(!raw)return toast('데이터를 붙여넣으세요');const r={name:'',nameEn:'',type:'LocalBusiness',address:'',phone:'',url:'',lat:'',lng:'',hours:'',description:''};
// URL only check
const isUrlOnly=raw.match(/^https?:\/\/\S+$/);if(isUrlOnly){r.url=raw;document.getElementById('parsedFields').innerHTML='<div style="padding:.8rem;background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.3);border-radius:8px;margin-bottom:.8rem"><div style="font-weight:600;color:var(--accent-amber);margin-bottom:.3rem">URL만 감지됨</div><div style="font-size:.78rem;color:var(--text-secondary);line-height:1.5">URL만으로는 매장 정보를 자동 분류할 수 없습니다.<br>아래 정보를 함께 붙여넣어주세요:</div><div style="font-size:.75rem;color:var(--text-muted);margin-top:.4rem;font-family:JetBrains Mono;background:var(--bg-input);padding:.5rem;border-radius:4px;line-height:1.8">강남스마일치과<br>서울 강남구 강남대로 396<br>02-555-1234<br>월~금 09:00-21:00<br>https://gangnam-smile.co.kr</div></div>'+'<div class="form-group" style="margin-bottom:.3rem"><label class="form-label">매장명 <span style="color:var(--accent-amber)">[직접 입력]</span></label><input class="form-input" id="parsed_name" value=""></div><div class="form-group" style="margin-bottom:.3rem"><label class="form-label">업종</label><select class="form-select" id="parsed_type">'+Object.entries(catMap).map(([v,n])=>'<option value="'+v+'">'+n+'</option>').join('')+'</select></div><div class="form-group" style="margin-bottom:.3rem"><label class="form-label">주소</label><input class="form-input" id="parsed_address" value=""></div><div class="form-group" style="margin-bottom:.3rem"><label class="form-label">전화</label><input class="form-input" id="parsed_phone" value=""></div><div class="form-group" style="margin-bottom:.3rem"><label class="form-label">웹사이트 <span style="color:var(--accent-green)">[감지]</span></label><input class="form-input" id="parsed_url" value="'+raw+'"></div><input type="hidden" id="parsed_lat" value=""><input type="hidden" id="parsed_lng" value=""><div style="display:flex;gap:.3rem;align-items:center;margin-top:.3rem"><button class="btn btn-outline btn-sm" onclick="geocode(\'parsed_address\',\'parsed_lat\',\'parsed_lng\',\'parsed_geo_st2\')" type="button">좌표 자동 검색</button><span id="parsed_geo_st2" style="font-size:.68rem"></span></div>';document.getElementById('parseResult').style.display='block';toast('URL만 감지 - 매장 정보를 추가 입력하세요');return;}
// Normal parse
const pm=raw.match(/(0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4})/);if(pm)r.phone=pm[0];const um=raw.match(/(https?:\/\/[^\s,]+)/);if(um)r.url=um[0];const am=raw.match(/(서울|부산|대구|인천|광주|대전|울산|경기|강원|충북|충남|전북|전남|경북|경남|제주)[^\n,]*?(구|시|군)[^\n,]*?(로|길|동)\s*\d*/);if(am)r.address=am[0].trim();const cm=raw.match(/@([\d.]+),([\d.]+)/);if(cm){r.lat=cm[1];r.lng=cm[2];}const cp={Dentist:/치과|dental/i,Hospital:/병원|hospital/i,Restaurant:/맛집|식당|고기|구이/i,CafeOrCoffeeShop:/카페|커피|cafe/i,BeautySalon:/미용|헤어|뷰티/i};for(const[t,p]of Object.entries(cp)){if(p.test(raw)){r.type=t;break;}}
// Name: skip URLs, emails, phone-only lines
const lines=raw.split('\n').map(l=>l.trim()).filter(Boolean);for(const line of lines){if(/^https?:\/\//.test(line))continue;if(/^0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4}$/.test(line))continue;if(/^[\d\s\-+().]+$/.test(line))continue;const c=line.replace(/[^\w가-힣\s]/g,'').trim();if(c.length>=2&&c.length<30){r.name=c;break;}}
const labels={name:'매장명',type:'업종',address:'주소',phone:'전화',url:'웹사이트'};document.getElementById('parsedFields').innerHTML=Object.entries(labels).map(([k,l])=>'<div class="form-group" style="margin-bottom:.3rem"><label class="form-label">'+l+(r[k]?' <span style="color:var(--accent-green)">[감지]</span>':' <span style="color:var(--text-muted)">[직접 입력]</span>')+'</label>'+(k==='type'?'<select class="form-select" id="parsed_'+k+'">'+Object.entries(catMap).map(([v,n])=>'<option value="'+v+'"'+(r[k]===v?' selected':'')+'>'+n+'</option>').join('')+'</select>':'<input class="form-input" id="parsed_'+k+'" value="'+(r[k]||'')+'">')+'</div>').join('')+'<input type="hidden" id="parsed_lat" value="'+(r.lat||'')+'"><input type="hidden" id="parsed_lng" value="'+(r.lng||'')+'"><div style="display:flex;gap:.3rem;align-items:center;margin-top:.3rem"><button class="btn btn-outline btn-sm" onclick="geocode(\'parsed_address\',\'parsed_lat\',\'parsed_lng\',\'parsed_geo_st\')" type="button">좌표 자동 검색</button><span id="parsed_geo_st" style="font-size:.68rem"></span></div>';document.getElementById('parseResult').style.display='block';
if(r.address&&!r.lat){setTimeout(()=>geocode('parsed_address','parsed_lat','parsed_lng','parsed_geo_st'),300);}
toast(r.name?'분류 완료':'일부 감지 - 나머지 직접 입력');}
function confirmAdd(){const n=gi('parsed_name');if(!n)return toast('매장명 입력');const t=gi('parsed_type');biz.push({id:slugify(n),name:n,nameEn:'',type:t,category:catMap[t]||'기타',description:'',address:gi('parsed_address'),phone:gi('parsed_phone'),url:gi('parsed_url'),lat:parseFloat(gi('parsed_lat'))||0,lng:parseFloat(gi('parsed_lng'))||0,hours:'',keywords:[],faq:[],maps:['google','naver','kakao'],status:'active',crankEnabled:true});svBiz();renderAll();document.getElementById('parseResult').style.display='none';document.getElementById('smartPasteInput').value='';toast(n+' 등록');}
function manualAddBiz(){const n=gi('f_name');if(!n)return toast('매장명 입력');const t=gi('f_category')||'LocalBusiness';const faq=gi('f_faq').split('\n').filter(l=>l.includes('|')).map(l=>{const[q,a]=l.split('|');return{q:q.trim(),a:(a||'').trim()};});biz.push({id:slugify(n),name:n,nameEn:gi('f_nameEn'),type:t,category:catMap[t]||'기타',description:gi('f_desc'),address:gi('f_address'),phone:gi('f_phone'),url:gi('f_url'),lat:parseFloat(gi('f_lat'))||0,lng:parseFloat(gi('f_lng'))||0,hours:gi('f_hours'),keywords:gi('f_keywords').split(',').map(s=>s.trim()).filter(Boolean),faq,maps:['google','naver','kakao'],status:'active',crankEnabled:true});svBiz();renderAll();toast(n+' 등록');['f_name','f_nameEn','f_phone','f_url','f_address','f_lat','f_lng','f_desc','f_hours','f_keywords','f_faq'].forEach(id=>si(id,''));}
// Freelancer add
function addFreelancer(){const n=gi('fl_name');if(!n)return toast('이름 입력');const job=gi('fl_job');free.push({id:slugify(n),name:n,nameEn:gi('fl_nameEn'),job,jobLabel:jobMap[job]||'프리랜서',company:gi('fl_company'),phone:gi('fl_phone'),areas:gi('fl_areas').split(',').map(s=>s.trim()).filter(Boolean),tagline:gi('fl_tagline'),description:gi('fl_desc'),sns:{instagram:gi('fl_insta'),youtube:gi('fl_youtube'),blog:gi('fl_blog'),kakao:gi('fl_kakao'),tiktok:gi('fl_tiktok'),facebook:gi('fl_facebook'),other:gi('fl_other')},certs:gi('fl_certs').split('\n').map(s=>s.trim()).filter(Boolean),specialties:gi('fl_specialties').split(',').map(s=>s.trim()).filter(Boolean),keywords:gi('fl_keywords').split(',').map(s=>s.trim()).filter(Boolean),faq:gi('fl_faq').split('\n').filter(l=>l.includes('|')).map(l=>{const[q,a]=l.split('|');return{q:q.trim(),a:(a||'').trim()};}),status:'active',crankEnabled:true});svFree();renderAll();toast(n+' 등록');clearFreeForm();}
function clearFreeForm(){['fl_name','fl_nameEn','fl_company','fl_phone','fl_areas','fl_tagline','fl_desc','fl_insta','fl_youtube','fl_blog','fl_kakao','fl_tiktok','fl_facebook','fl_other','fl_certs','fl_specialties','fl_keywords','fl_faq'].forEach(id=>si(id,''));}
// Edit / Delete
function editBiz(id){const b=biz.find(x=>x.id===id);if(!b)return;document.getElementById('modalContent').innerHTML='<h3>'+b.name+' 수정</h3><div class="form-group"><label class="form-label">매장명</label><input class="form-input" id="e_name" value="'+b.name+'"></div><div class="form-group"><label class="form-label">설명</label><textarea class="form-textarea" id="e_desc" style="min-height:40px">'+(b.description||'')+'</textarea></div><div class="form-group"><label class="form-label">전화</label><input class="form-input" id="e_phone" value="'+b.phone+'"></div><div class="form-group"><label class="form-label">주소</label><input class="form-input" id="e_addr" value="'+(b.address||'')+'"></div><div class="form-group"><label class="form-label">키워드</label><input class="form-input" id="e_kw" value="'+(b.keywords||[]).join(', ')+'"></div><div style="display:flex;gap:.3rem;margin-top:.8rem"><button class="btn btn-success" onclick="doEditBiz(\''+id+'\')">저장</button><button class="btn btn-outline" onclick="closeModal()">취소</button></div>';document.getElementById('modalOverlay').classList.add('show');}
function doEditBiz(id){const b=biz.find(x=>x.id===id);if(!b)return;b.name=gi('e_name');b.description=gi('e_desc');b.phone=gi('e_phone');b.address=gi('e_addr');b.keywords=gi('e_kw').split(',').map(s=>s.trim()).filter(Boolean);svBiz();renderAll();closeModal();toast('수정 완료');}
function removeBiz(id){if(!confirm('삭제?'))return;biz=biz.filter(b=>b.id!==id);svBiz();renderAll();toast('삭제');}
function editFree(id){const f=free.find(x=>x.id===id);if(!f)return;const sn=f.sns||{};document.getElementById('modalContent').innerHTML='<h3>'+f.name+' 수정</h3><div class="form-group"><label class="form-label">이름</label><input class="form-input" id="ef_name" value="'+f.name+'"></div><div class="form-group"><label class="form-label">소속</label><input class="form-input" id="ef_company" value="'+(f.company||'')+'"></div><div class="form-group"><label class="form-label">소개</label><textarea class="form-textarea" id="ef_desc" style="min-height:40px">'+(f.description||'')+'</textarea></div><div class="form-group"><label class="form-label">전화</label><input class="form-input" id="ef_phone" value="'+f.phone+'"></div><div class="form-group"><label class="form-label">활동지역</label><input class="form-input" id="ef_areas" value="'+(f.areas||[]).join(', ')+'"></div><div class="form-group"><label class="form-label">인스타그램</label><input class="form-input" id="ef_insta" value="'+(sn.instagram||'')+'"></div><div class="form-group"><label class="form-label">유튜브</label><input class="form-input" id="ef_youtube" value="'+(sn.youtube||'')+'"></div><div class="form-group"><label class="form-label">네이버블로그</label><input class="form-input" id="ef_blog" value="'+(sn.blog||'')+'"></div><div class="form-group"><label class="form-label">카카오채널</label><input class="form-input" id="ef_kakao" value="'+(sn.kakao||'')+'"></div><div class="form-group"><label class="form-label">키워드</label><input class="form-input" id="ef_kw" value="'+(f.keywords||[]).join(', ')+'"></div><div style="display:flex;gap:.3rem;margin-top:.8rem"><button class="btn btn-pink" onclick="doEditFree(\''+id+'\')">저장</button><button class="btn btn-outline" onclick="closeModal()">취소</button></div>';document.getElementById('modalOverlay').classList.add('show');}
function doEditFree(id){const f=free.find(x=>x.id===id);if(!f)return;f.name=gi('ef_name');f.company=gi('ef_company');f.description=gi('ef_desc');f.phone=gi('ef_phone');f.areas=gi('ef_areas').split(',').map(s=>s.trim()).filter(Boolean);if(!f.sns)f.sns={};f.sns.instagram=gi('ef_insta');f.sns.youtube=gi('ef_youtube');f.sns.blog=gi('ef_blog');f.sns.kakao=gi('ef_kakao');f.keywords=gi('ef_kw').split(',').map(s=>s.trim()).filter(Boolean);svFree();renderAll();closeModal();toast('수정 완료');}
function removeFree(id){if(!confirm('삭제?'))return;free=free.filter(f=>f.id!==id);svFree();renderAll();toast('삭제');}
// Build
function runBuild(){const con=document.getElementById('buildConsole');const out=document.getElementById('consoleOutput');con.style.display='block';out.innerHTML='';const ab=biz.filter(b=>b.status==='active');const af=free.filter(f=>f.status==='active');const L=[{c:'c-info',t:'=== XIVIX Tower Control 빌드 ==='},{c:'c-dim',t:'도메인: '+cfg.domain},{c:'c-dim',t:'매장: '+ab.length+' | 프리랜서: '+af.length},{c:'',t:''}];
ab.forEach(b=>{L.push({c:'c-ok',t:'  [매장] '+b.name+' > index.html + llms.txt'});});
af.forEach(f=>{L.push({c:'c-pink',t:'  [프리랜서] '+f.name+' > linkhub.html + profile.json'});L.push({c:'c-pink',t:'    Schema: Person + '+f.job});const sc=Object.values(f.sns||{}).filter(Boolean).length;if(sc)L.push({c:'c-dim',t:'    SNS '+sc+'개 채널 연동'});});
L.push({c:'',t:''},{c:'c-ok',t:'  sitemap.xml / robots.txt / llms.txt'},{c:'c-ok',t:'  crank-config.json (매장+프리랜서)'},{c:'',t:''},{c:'c-info',t:'빌드 완료! '+(ab.length*2+af.length*2+4)+'개 파일'},{c:'c-ok',t:'SEO AEO GEO C-RANK N-Logic [OK]'});
let i=0;const iv=setInterval(()=>{if(i>=L.length){clearInterval(iv);return;}out.innerHTML+='<div class="'+L[i].c+'">'+(L[i].t||'&nbsp;')+'</div>';out.scrollTop=out.scrollHeight;i++;},70);}
function runDeploy(){runBuild();const total=biz.length+free.length;setTimeout(()=>{const out=document.getElementById('consoleOutput');[{c:'',t:''},{c:'c-info',t:'배포 시작...'},{c:'c-warn',t:'  '+cfg.domain},{c:'c-ok',t:'  [OK] 업로드'},{c:'c-ok',t:'  [OK] 완료!'}].forEach((l,i)=>setTimeout(()=>{out.innerHTML+='<div class="'+l.c+'">'+(l.t||'&nbsp;')+'</div>';out.scrollTop=out.scrollHeight;},i*100));},total*2*70+500);}
// Preview
function renderPrevSel(){const s=document.getElementById('previewSelect');if(!s)return;s.innerHTML='<option value="index">디렉토리</option>'+biz.map(b=>'<option value="biz:'+b.id+'">[매장] '+b.name+'</option>').join('')+free.map(f=>'<option value="free:'+f.id+'">[프리랜서] '+f.name+'</option>').join('');updatePreview();}
function updatePreview(){const sel=gi('previewSelect');const el=document.getElementById('previewContent');if(!el)return;if(sel==='index'){el.innerHTML='<h2 style="margin-bottom:.5rem">Brand Directory</h2>'+biz.filter(b=>b.status==='active').map(b=>'<div style="border:1px solid #e5e7eb;border-radius:8px;padding:.6rem;margin-bottom:.4rem"><strong>'+b.name+'</strong> <span style="color:#3b82f6;font-size:.72rem">매장</span><br><span style="color:#6b7280;font-size:.8rem">'+b.description+'</span></div>').join('')+free.filter(f=>f.status==='active').map(f=>'<div style="border:1px solid #fce7f3;border-radius:8px;padding:.6rem;margin-bottom:.4rem"><strong>'+f.name+'</strong> <span style="color:#ec4899;font-size:.72rem">'+f.jobLabel+'</span><br><span style="color:#6b7280;font-size:.8rem">'+f.tagline+'</span></div>').join('');}
else if(sel.startsWith('biz:')){const b=biz.find(x=>x.id===sel.slice(4));if(b)el.innerHTML='<h1 style="font-size:1.1rem">'+b.name+'</h1><p style="color:#6b7280">'+b.category+'</p><p>'+b.description+'</p><p>'+b.address+'</p><p>'+b.phone+'</p>';}
else if(sel.startsWith('free:')){const f=free.find(x=>x.id===sel.slice(5));if(f){const sns=Object.entries(f.sns||{}).filter(([k,v])=>v);el.innerHTML='<div style="text-align:center;padding:1rem"><div style="width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#ec4899,#8b5cf6);margin:0 auto .5rem;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.3rem;font-weight:700">'+f.name[0]+'</div><h1 style="font-size:1.2rem">'+f.name+'</h1><p style="color:#ec4899;font-size:.85rem">'+f.jobLabel+(f.company?' | '+f.company:'')+'</p><p style="color:#6b7280;margin:.5rem 0;font-size:.85rem">'+f.tagline+'</p><p style="font-size:.8rem;margin-bottom:.8rem">활동지역: '+(f.areas||[]).join(', ')+'</p>'+(f.certs?.length?'<div style="margin-bottom:.8rem">'+f.certs.map(c=>'<span style="display:inline-block;background:#f3f4f6;color:#374151;padding:.2rem .5rem;border-radius:4px;font-size:.72rem;margin:.1rem">'+c+'</span>').join('')+'</div>':'')+'<div style="display:flex;flex-direction:column;gap:.4rem;max-width:280px;margin:0 auto">'+sns.map(([k,v])=>'<a href="'+v+'" target="_blank" style="display:block;padding:.55rem;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;text-decoration:none;color:#1f2937;font-size:.82rem;font-weight:500">'+k.toUpperCase()+'</a>').join('')+'</div>'+(f.faq?.length?'<div style="text-align:left;margin-top:1rem"><h3 style="font-size:.9rem;margin-bottom:.4rem">FAQ</h3>'+f.faq.map(x=>'<p style="margin:.3rem 0"><strong>Q: '+x.q+'</strong><br>A: '+x.a+'</p>').join('')+'</div>':'')+'<div style="margin-top:1rem;padding-top:.8rem;border-top:1px solid #e5e7eb;font-size:.65rem;color:#9ca3af">Schema.org: Person + ProfessionalService ('+f.job+')<br>llms.txt | FAQ RichSnippet | SNS sameAs</div></div>';}}}
// Demo
function runDemo(){document.getElementById('demoOutput').style.display='block';const con=document.getElementById('demoConsole');con.innerHTML='';const L=[{c:'c-info',t:'=== XIVIX 데모 ==='},{c:'',t:''},{c:'c-dim',t:'[매장] 강남스마일치과'},{c:'c-ok',t:'  Schema: LocalBusiness + Dentist'},{c:'c-ok',t:'  지도: Google/네이버/카카오'},{c:'',t:''},{c:'c-dim',t:'[프리랜서] 김보험프로'},{c:'c-pink',t:'  Schema: Person + InsuranceAgent'},{c:'c-pink',t:'  SNS: 인스타/유튜브/블로그/카카오'},{c:'c-pink',t:'  링크허브 페이지 생성'},{c:'',t:''},{c:'c-dim',t:'[빌드 결과]'},{c:'c-ok',t:'  SEO: Schema.org JSON-LD'},{c:'c-ok',t:'  AEO: llms.txt (AI 크롤러용)'},{c:'c-ok',t:'  GEO: FAQ 리치스니펫'},{c:'c-ok',t:'  C-RANK: 네이버 카페 연동'},{c:'',t:''},{c:'c-dim',t:'[검색 시나리오]'},{c:'',t:''},{c:'c-warn',t:'  "강남 치과" (구글)'},{c:'c-ok',t:'  -> 강남스마일치과 리치 결과'},{c:'',t:''},{c:'c-warn',t:'  "강남 보험설계사 추천" (구글)'},{c:'c-pink',t:'  -> 김보험프로 Person 프로필 노출'},{c:'',t:''},{c:'c-warn',t:'  "좋은 보험설계사?" (ChatGPT)'},{c:'c-pink',t:'  -> llms.txt 기반: MDRT 5회, 고객 800명'},{c:'',t:''},{c:'c-warn',t:'  "변액보험 추천" (네이버)'},{c:'c-pink',t:'  -> C-RANK 카페글 + 블로그 연동'},{c:'',t:''},{c:'c-info',t:'=== 완료 ==='}];let i=0;const iv=setInterval(()=>{if(i>=L.length){clearInterval(iv);return;}con.innerHTML+='<div class="'+L[i].c+'">'+(L[i].t||'&nbsp;')+'</div>';con.scrollTop=con.scrollHeight;i++;},90);}
function exportJSON(){const blob=new Blob([JSON.stringify({businesses:biz,freelancers:free,config:cfg},null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='xivix-export.json';a.click();toast('JSON 내보내기');}
function doImport(el){const f=el.files[0];if(!f)return;const r=new FileReader();r.onload=e=>{try{const d=JSON.parse(e.target.result);if(d.businesses){biz=d.businesses;svBiz();}if(d.freelancers){free=d.freelancers;svFree();}if(d.config){cfg={...cfg,...d.config};localStorage.setItem('xivix_cfg2',JSON.stringify(cfg));}renderAll();toast('가져오기 완료');}catch(e){toast('JSON 오류');}};r.readAsText(f);}
function resetAll(){if(!confirm('모든 데이터 초기화?'))return;localStorage.removeItem('xivix_biz3');localStorage.removeItem('xivix_free');localStorage.removeItem('xivix_cfg2');location.reload();}
// Kakao Local API
function testKakao(){if(!cfg.kakaoKey)return toast('카카오 REST API 키를 먼저 입력');fetch('https://dapi.kakao.com/v2/local/search/keyword.json?query=강남역',{headers:{Authorization:'KakaoAK '+cfg.kakaoKey}}).then(r=>r.json()).then(d=>{if(d.documents)toast('카카오 API 연결 성공! ('+d.documents.length+'건)');else toast('실패: '+(d.message||'키 확인'));}).catch(()=>toast('연결 실패'));}
// Search tab - search and register directly
async function doSearchAdd(){const q=gi('searchQ');if(!cfg.kakaoKey)return toast('설정 > 카카오 API 키를 먼저 등록하세요');if(!q)return toast('매장명을 입력하세요');const rc=document.getElementById('searchResult');rc.innerHTML='<div style="color:var(--accent-amber);font-size:.82rem;padding:.8rem;text-align:center">검색중...</div>';try{const res=await fetch('https://dapi.kakao.com/v2/local/search/keyword.json?query='+encodeURIComponent(q)+'&size=10',{headers:{Authorization:'KakaoAK '+cfg.kakaoKey}});const d=await res.json();if(!d.documents||!d.documents.length){rc.innerHTML='<div style="color:var(--accent-red);font-size:.82rem;padding:.8rem;text-align:center">검색 결과 없음</div>';return;}window._searchResults=d.documents;rc.innerHTML=d.documents.map((p,i)=>{const cat=p.category_name||'';return'<div style="padding:.7rem;border:1px solid var(--border);border-radius:8px;margin-bottom:.4rem;display:flex;justify-content:space-between;align-items:center;gap:.5rem"><div style="flex:1;min-width:0"><div style="font-weight:600;font-size:.85rem">'+p.place_name+'</div><div style="font-size:.75rem;color:var(--text-secondary);margin-top:.15rem">'+p.address_name+'</div><div style="font-size:.7rem;color:var(--text-muted);margin-top:.1rem">'+cat+(p.phone?' | '+p.phone:'')+'</div></div><button class="btn btn-success btn-sm" onclick="quickRegister('+i+')">등록</button></div>';}).join('');}catch(e){rc.innerHTML='<div style="color:var(--accent-red);font-size:.82rem;padding:.8rem">오류: '+e.message+'</div>';}}
function quickRegister(idx){const p=window._searchResults[idx];if(!p)return;const cat=p.category_name||'';const autoType=cat.includes('치과')?'Dentist':cat.includes('병원')||cat.includes('의원')?'Hospital':cat.includes('음식')||cat.includes('식당')?'Restaurant':cat.includes('카페')||cat.includes('커피')?'CafeOrCoffeeShop':cat.includes('미용')||cat.includes('헤어')||cat.includes('뷰티')?'BeautySalon':cat.includes('매장')||cat.includes('판매')?'Store':'LocalBusiness';
if(biz.find(b=>b.name===p.place_name)){return toast(p.place_name+' 이미 등록됨');}
biz.push({id:slugify(p.place_name),name:p.place_name,nameEn:'',type:autoType,category:catMap[autoType]||'기타',description:'',address:p.address_name,phone:p.phone||'',url:p.place_url||'',lat:parseFloat(p.y)||0,lng:parseFloat(p.x)||0,hours:'',keywords:[],faq:[],maps:['google','naver','kakao'],status:'active',crankEnabled:true});svBiz();renderAll();
// Update UI
const items=document.querySelectorAll('#searchResult > div');if(items[idx]){items[idx].style.borderColor='var(--accent-green)';items[idx].querySelector('button').outerHTML='<span class="status status-active">등록됨</span>';}toast(p.place_name+' 등록 완료');}
async function kakaoSearch(query,resultContainerId){if(!cfg.kakaoKey)return toast('설정 > 카카오 API 키를 먼저 등록하세요');if(!query)return toast('검색어를 입력하세요');const rc=document.getElementById(resultContainerId);if(rc)rc.innerHTML='<div style="color:var(--accent-amber);font-size:.78rem;padding:.5rem">검색중...</div>';try{const res=await fetch('https://dapi.kakao.com/v2/local/search/keyword.json?query='+encodeURIComponent(query)+'&size=5',{headers:{Authorization:'KakaoAK '+cfg.kakaoKey}});const d=await res.json();if(!d.documents||!d.documents.length){if(rc)rc.innerHTML='<div style="color:var(--accent-red);font-size:.78rem;padding:.5rem">검색 결과 없음</div>';return;}if(rc)rc.innerHTML=d.documents.map((p,i)=>'<div onclick="selectPlace('+i+')" style="padding:.6rem;border:1px solid var(--border);border-radius:6px;margin-bottom:.3rem;cursor:pointer;transition:border-color .15s" onmouseover="this.style.borderColor=\'var(--accent-blue)\'" onmouseout="this.style.borderColor=\'var(--border)\'" data-idx="'+i+'"><div style="font-weight:600;font-size:.82rem">'+p.place_name+'</div><div style="font-size:.72rem;color:var(--text-secondary);margin-top:.15rem">'+p.address_name+(p.phone?' | '+p.phone:'')+'</div><div style="font-size:.65rem;color:var(--text-muted)">'+p.category_name+'</div></div>').join('');window._kakaoResults=d.documents;}catch(e){if(rc)rc.innerHTML='<div style="color:var(--accent-red);font-size:.78rem;padding:.5rem">오류: '+e.message+'</div>';}}
function selectPlace(idx){const p=window._kakaoResults[idx];if(!p)return;
// Detect which form is visible
const isSmartPaste=document.getElementById('page-add-biz').style.display!=='none'&&document.getElementById('parseResult');
const isManual=document.getElementById('bizTab-manual')&&document.getElementById('bizTab-manual').style.display!=='none';
if(isManual||document.getElementById('f_name')){si('f_name',p.place_name);si('f_address',p.address_name);si('f_phone',p.phone||'');si('f_url',p.place_url||'');si('f_lat',p.y);si('f_lng',p.x);const fgs=document.getElementById('f_geo_st');if(fgs)fgs.innerHTML='<span style="color:var(--accent-green)">좌표: '+parseFloat(p.y).toFixed(4)+', '+parseFloat(p.x).toFixed(4)+' [카카오]</span>';
// Auto-detect category
const cat=p.category_name||'';const autoType=cat.includes('치과')?'Dentist':cat.includes('병원')||cat.includes('의원')?'Hospital':cat.includes('음식')||cat.includes('식당')?'Restaurant':cat.includes('카페')||cat.includes('커피')?'CafeOrCoffeeShop':cat.includes('미용')||cat.includes('헤어')?'BeautySalon':'LocalBusiness';si('f_category',autoType);}
document.getElementById('kakaoSearchResult').innerHTML='<div style="padding:.5rem;color:var(--accent-green);font-size:.78rem">'+p.place_name+' 선택됨</div>';toast(p.place_name+' 자동 입력 완료');}
// Geocode - address to coordinates
async function geocode(addrId,latId,lngId,statusId){const addr=gi(addrId);if(!addr)return toast('주소를 먼저 입력하세요');const st=document.getElementById(statusId);if(st)st.innerHTML='<span style="color:var(--accent-amber)">검색중...</span>';try{const res=await fetch('https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(addr)+'&countrycodes=kr&limit=1',{headers:{'Accept-Language':'ko'}});const data=await res.json();if(data.length){si(latId,parseFloat(data[0].lat).toFixed(6));si(lngId,parseFloat(data[0].lon).toFixed(6));if(st)st.innerHTML='<span style="color:var(--accent-green)">좌표: '+data[0].lat.slice(0,9)+', '+data[0].lon.slice(0,10)+' [자동]</span>';toast('좌표 검색 완료');}else{if(st)st.innerHTML='<span style="color:var(--accent-red)">주소를 찾지 못했습니다. 더 상세한 주소를 입력하세요.</span>';}}catch(e){if(st)st.innerHTML='<span style="color:var(--accent-red)">네트워크 오류</span>';}}
function slugify(s){return s.replace(/[가-힣]+/g,w=>{const m={'치과':'dental','병원':'hospital','식당':'rest','카페':'cafe','보험':'insurance','딜러':'dealer','부동산':'realestate'};for(const[k,v]of Object.entries(m))if(w.includes(k))return v;return w;}).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'')||'item-'+Date.now();}
function toast(m){const e=document.getElementById('toast');e.textContent=m;e.classList.add('show');setTimeout(()=>e.classList.remove('show'),2500);}
function closeModal(){document.getElementById('modalOverlay').classList.remove('show');}
document.getElementById('modalOverlay').addEventListener('click',e=>{if(e.target===e.currentTarget)closeModal();});
renderAll();
</script>
</body>
</html>
